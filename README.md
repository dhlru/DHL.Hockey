<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ДХЛ - Дворовая Хоккейная Лига</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- PWA метатеги -->
    <meta name="theme-color" content="#0a0a0a">
    <meta name="description" content="Драконья Хоккейная Лига - самая экстремальная хоккейная лига">
    <link rel="manifest" href="manifest.json">
    <!-- Firebase SDK v9 (модульная версия) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, push, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";
        
        // Экспортируем Firebase функции в глобальную область видимости
        window.firebaseModules = {
            initializeApp,
            getDatabase,
            ref,
            set,
            onValue,
            push,
            remove,
            update,
            getStorage,
            storageRef,
            uploadBytes,
            getDownloadURL
        };
    </script>
    <style>
        /* Стили остаются без изменений */
        :root {
            --metal-dark: #0a0a0a;
            --metal-darker: #000000;
            --metal-light: #1a1a1a;
            --metal-border: #2a2a2a;
            --accent-red: #ff0033;
            --accent-red-dark: #cc0029;
            --accent-blue: #0066ff;
            --accent-blue-dark: #0052cc;
            --text-white: #ffffff;
            --text-gray: #cccccc;
            --text-light: #f0f0f0;
            --glow-red: 0 0 15px rgba(255, 0, 51, 0.7);
            --glow-blue: 0 0 15px rgba(0, 102, 255, 0.7);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--metal-dark);
            color: var(--text-white);
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(255, 0, 51, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 80% 70%, rgba(0, 102, 255, 0.05) 0%, transparent 20%),
                linear-gradient(to bottom, var(--metal-darker), var(--metal-dark));
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            transition: margin-right 0.3s ease, margin-left 0.3s ease;
        }
        
        .container.shifted-right {
            margin-right: 480px;
        }
        
        .container.shifted-left {
            margin-left: 480px;
        }
        
        .header {
            background: linear-gradient(to right, var(--metal-darker), var(--metal-light));
            border-bottom: 3px solid var(--accent-red);
            padding: 15px 0;
            position: relative;
            box-shadow: var(--glow-red);
            margin-bottom: 30px;
            border-radius: 0 0 10px 10px;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            position: relative;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .logo-section:hover {
            transform: scale(1.02);
        }
        
        .logo-section:hover .logo-icon {
            transform: rotate(10deg);
        }
        
        .logo-icon {
            color: var(--accent-red);
            font-size: 2.5rem;
            margin-right: 15px;
            text-shadow: var(--glow-red);
            transition: transform 0.3s ease;
        }
        
        .logo-text {
            font-size: 2.8rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 3px;
            background: linear-gradient(to right, var(--accent-red), var(--text-white));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }
        
        .nav-tabs {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 15px;
        }
        
        .nav-btn {
            background: var(--metal-light);
            color: var(--text-gray);
            border: 2px solid var(--metal-border);
            padding: 12px 25px;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .nav-btn:hover {
            color: var(--text-white);
            border-color: var(--accent-red);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 0, 51, 0.2);
        }
        
        .nav-btn.active {
            background: linear-gradient(145deg, var(--accent-red-dark), var(--accent-red));
            color: var(--text-white);
            border-color: var(--accent-red);
            box-shadow: var(--glow-red);
        }
        
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .news-card {
            background: linear-gradient(145deg, var(--metal-light), var(--metal-darker));
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--metal-border);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .news-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-red);
            box-shadow: 0 15px 30px rgba(255, 0, 51, 0.1);
        }
        
        .news-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-bottom: 3px solid var(--accent-red);
        }
        
        .news-content {
            padding: 20px;
        }
        
        .news-date {
            color: var(--accent-red);
            font-size: 0.9rem;
            margin-bottom: 10px;
            display: block;
        }
        
        .news-title {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--text-white);
        }
        
        .news-text {
            color: var(--text-gray);
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .read-more-btn {
            background: linear-gradient(145deg, var(--accent-blue-dark), var(--accent-blue));
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .read-more-btn:hover {
            background: linear-gradient(145deg, var(--accent-blue), #1a75ff);
            transform: translateY(-2px);
        }
        
        .news-full-text {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--metal-border);
            color: var(--text-light);
            line-height: 1.6;
        }
        
        .news-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 4000;
            padding: 20px;
        }
        
        .news-modal {
            background: linear-gradient(145deg, var(--metal-dark), var(--metal-darker));
            border-radius: 15px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 3px solid var(--accent-red);
            box-shadow: var(--glow-red);
        }
        
        .news-modal-header {
            background: linear-gradient(to right, var(--metal-darker), var(--metal-light));
            padding: 20px;
            border-bottom: 3px solid var(--accent-red);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .news-modal-close {
            background: none;
            border: none;
            color: var(--text-white);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .news-modal-close:hover {
            color: var(--accent-red);
        }
        
        .news-modal-body {
            padding: 30px;
        }
        
        .news-modal-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid var(--metal-border);
        }
        
        .news-modal-title {
            font-size: 2rem;
            margin-bottom: 15px;
            color: var(--text-white);
        }
        
        .news-modal-date {
            color: var(--accent-red);
            font-size: 1rem;
            margin-bottom: 20px;
            display: block;
        }
        
        .news-modal-content {
            color: var(--text-light);
            line-height: 1.8;
            font-size: 1.1rem;
        }
        
        .secondary-tournament-card {
            background: linear-gradient(145deg, var(--metal-light), var(--metal-darker));
            border: 2px solid var(--metal-border);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .secondary-tournament-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(to right, var(--accent-blue), #00ccff);
        }
        
        .tournament-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .tournament-icon {
            font-size: 2.5rem;
            color: var(--accent-blue);
            margin-right: 20px;
            text-shadow: 0 0 15px rgba(0, 102, 255, 0.5);
        }
        
        .tournament-title {
            font-size: 2rem;
            color: var(--text-white);
            margin-bottom: 5px;
        }
        
        .tournament-subtitle {
            color: var(--text-gray);
            font-size: 1.1rem;
        }
        
        .tournament-teams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .tournament-team-card {
            background: var(--metal-darker);
            border: 1px solid var(--metal-border);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .tournament-team-card:hover {
            border-color: var(--accent-blue);
            transform: translateY(-2px);
        }
        
        .tournament-team-logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 15px;
            border: 2px solid var(--metal-border);
        }
        
        .tournament-team-name {
            font-weight: 600;
            color: var(--text-white);
            flex: 1;
        }
        
        .tournament-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .tournament-table th {
            background: linear-gradient(to right, var(--metal-darker), var(--metal-light));
            color: var(--text-white);
            padding: 15px;
            text-align: left;
            border-bottom: 3px solid var(--accent-blue);
        }
        
        .tournament-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--metal-border);
            color: var(--text-gray);
        }
        
        .tournament-table tr:hover td {
            background-color: rgba(0, 102, 255, 0.05);
            color: var(--text-white);
        }
        
        .team-status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-qualified {
            background: rgba(0, 255, 0, 0.1);
            color: #00ff00;
            border: 1px solid rgba(0, 255, 0, 0.3);
        }
        
        .status-eliminated {
            background: rgba(255, 0, 51, 0.1);
            color: var(--accent-red);
            border: 1px solid rgba(255, 0, 51, 0.3);
        }
        
        .status-pending {
            background: rgba(255, 165, 0, 0.1);
            color: #ffa500;
            border: 1px solid rgba(255, 165, 0, 0.3);
        }
        
        .tournament-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid var(--metal-border);
        }
        
        .team-selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: var(--metal-dark);
            border-radius: 8px;
            border: 1px solid var(--metal-border);
        }
        
        .team-select-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: var(--metal-light);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--metal-border);
        }
        
        .team-select-item:hover {
            border-color: var(--accent-blue);
            background: rgba(0, 102, 255, 0.05);
        }
        
        .team-select-item.selected {
            border-color: var(--accent-blue);
            background: rgba(0, 102, 255, 0.1);
        }
        
        .team-select-checkbox {
            margin-right: 10px;
        }
        
        .team-select-name {
            color: var(--text-white);
            font-size: 0.9rem;
        }
        
        .news-views {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--text-gray);
            font-size: 0.8rem;
            margin-top: 10px;
        }
        
        .news-views i {
            color: var(--accent-red);
        }
        
        .text-card {
            background: linear-gradient(145deg, var(--metal-light), var(--metal-darker));
            border: 1px solid var(--metal-border);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            position: relative;
        }
        
        .text-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .text-card-title {
            font-size: 1.4rem;
            color: var(--text-white);
        }
        
        .text-card-content {
            color: var(--text-gray);
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .text-card-edit-btn {
            background: linear-gradient(145deg, var(--accent-blue-dark), var(--accent-blue));
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .text-card-edit-btn:hover {
            background: linear-gradient(145deg, var(--accent-blue), #1a75ff);
            transform: translateY(-2px);
        }
        
        .text-editor {
            margin-top: 15px;
            display: none;
        }
        
        .text-editor textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            background: var(--metal-dark);
            border: 2px solid var(--metal-border);
            border-radius: 8px;
            color: var(--text-white);
            font-size: 1rem;
            resize: vertical;
        }
        
        .text-editor-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .admin-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(145deg, var(--accent-red-dark), var(--accent-red));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            box-shadow: var(--glow-red);
            border: 3px solid var(--metal-darker);
            transition: all 0.3s ease;
        }
        
        .admin-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 0 25px rgba(255, 0, 51, 0.8);
        }
        
        .admin-toggle i {
            font-size: 1.8rem;
            color: var(--text-white);
        }
        
        .admin-panel {
            position: fixed;
            top: 0;
            right: -500px;
            width: 480px;
            height: 100vh;
            background: linear-gradient(to bottom, var(--metal-darker), var(--metal-dark));
            z-index: 999;
            transition: right 0.4s ease;
            border-left: 3px solid var(--accent-red);
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
        }
        
        .admin-panel.active {
            right: 0;
        }
        
        .admin-panel.left-side {
            right: auto;
            left: -500px;
            border-left: none;
            border-right: 3px solid var(--accent-red);
            box-shadow: 10px 0 30px rgba(0, 0, 0, 0.5);
        }
        
        .admin-panel.left-side.active {
            left: 0;
            right: auto;
        }
        
        .admin-header {
            background: linear-gradient(to right, var(--metal-darker), var(--metal-light));
            padding: 20px;
            border-bottom: 3px solid var(--accent-red);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-position-toggle {
            width: 40px;
            height: 40px;
            background: var(--metal-light);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-gray);
            border: 2px solid var(--metal-border);
            transition: all 0.3s ease;
        }
        
        .admin-position-toggle:hover {
            color: var(--accent-red);
            border-color: var(--accent-red);
            transform: rotate(180deg);
        }
        
        .admin-tabs-container {
            position: relative;
            overflow-x: auto;
            border-bottom: 1px solid var(--metal-border);
            background-color: var(--metal-light);
            scrollbar-width: thin;
            scrollbar-color: var(--accent-red) var(--metal-dark);
        }
        
        .admin-tabs-container::-webkit-scrollbar {
            height: 6px;
        }
        
        .admin-tabs-container::-webkit-scrollbar-track {
            background: var(--metal-dark);
        }
        
        .admin-tabs-container::-webkit-scrollbar-thumb {
            background: var(--accent-red);
            border-radius: 3px;
        }
        
        .admin-tabs {
            display: flex;
            min-width: max-content;
            width: 100%;
        }
        
        .admin-tab {
            flex: 1;
            min-width: 120px;
            padding: 18px 15px;
            text-align: center;
            cursor: pointer;
            color: var(--text-gray);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }
        
        .admin-tab:hover {
            color: var(--text-white);
            background-color: rgba(255, 0, 51, 0.1);
        }
        
        .admin-tab.active {
            color: var(--accent-red);
            border-bottom: 3px solid var(--accent-red);
            background-color: rgba(255, 0, 51, 0.05);
        }
        
        .admin-content {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }
        
        .admin-section {
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-light);
            font-weight: 600;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 14px;
            background-color: var(--metal-light);
            border: 2px solid var(--metal-border);
            border-radius: 8px;
            color: var(--text-white);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent-red);
            box-shadow: 0 0 10px rgba(255, 0, 51, 0.3);
        }
        
        .btn {
            padding: 14px 28px;
            background: linear-gradient(145deg, var(--accent-red-dark), var(--accent-red));
            color: var(--text-white);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn:hover {
            background: linear-gradient(145deg, var(--accent-red), #ff1a4d);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 0, 51, 0.3);
        }
        
        .btn-blue {
            background: linear-gradient(145deg, var(--accent-blue-dark), var(--accent-blue));
        }
        
        .btn-blue:hover {
            background: linear-gradient(145deg, var(--accent-blue), #1a75ff);
            box-shadow: 0 8px 20px rgba(0, 102, 255, 0.3);
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .loader {
            border: 4px solid var(--metal-border);
            border-top: 4px solid var(--accent-red);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(145deg, var(--accent-red-dark), var(--accent-red));
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            display: none;
            align-items: center;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @media (max-width: 1200px) {
            .container {
                padding: 15px;
            }
            
            .admin-panel {
                width: 100%;
                right: -100%;
            }
            
            .admin-panel.left-side {
                left: -100%;
            }
            
            .container.shifted-right,
            .container.shifted-left {
                margin-right: 0;
                margin-left: 0;
            }
            
            .shift-controls {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .logo-text {
                font-size: 2rem;
            }
            
            .nav-tabs {
                justify-content: flex-start;
                overflow-x: auto;
                padding-bottom: 10px;
            }
            
            .nav-btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .tournament-teams-grid {
                grid-template-columns: 1fr;
            }
            
            .team-selection-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .team-list-item {
            background: var(--metal-light);
            border: 1px solid var(--metal-border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }
        
        .team-list-item:hover {
            border-color: var(--accent-red);
            background: rgba(255, 0, 51, 0.05);
        }
        
        .team-list-info {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .team-list-logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 15px;
            border: 2px solid var(--metal-border);
        }
        
        .team-list-name {
            font-weight: 600;
            color: var(--text-white);
        }
        
        .team-list-stats {
            font-size: 0.9rem;
            color: var(--text-gray);
            margin-top: 5px;
        }
        
        .team-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--metal-border);
            background: var(--metal-darker);
            color: var(--text-gray);
        }
        
        .action-btn:hover {
            transform: scale(1.1);
        }
        
        .action-btn.edit:hover {
            color: var(--accent-blue);
            border-color: var(--accent-blue);
            background: rgba(0, 102, 255, 0.1);
        }
        
        .action-btn.delete:hover {
            color: var(--accent-red);
            border-color: var(--accent-red);
            background: rgba(255, 0, 51, 0.1);
        }
        
        .match-card {
            background: linear-gradient(145deg, var(--metal-light), var(--metal-darker));
            border: 1px solid var(--metal-border);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .match-card:hover {
            border-color: var(--accent-blue);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 102, 255, 0.1);
        }
        
        .match-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--metal-border);
        }
        
        .match-date {
            color: var(--text-gray);
            font-size: 0.9rem;
        }
        
        .match-round {
            color: var(--accent-blue);
            font-weight: bold;
            padding: 5px 10px;
            background: rgba(0, 102, 255, 0.1);
            border-radius: 20px;
            font-size: 0.8rem;
        }
        
        .match-body {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .match-team {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .match-team-home {
            justify-content: flex-start;
        }
        
        .match-team-away {
            justify-content: flex-end;
            flex-direction: row-reverse;
        }
        
        .match-team-logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 15px;
            border: 2px solid var(--metal-border);
        }
        
        .match-team-name {
            font-weight: 600;
            color: var(--text-white);
        }
        
        .match-score {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-red);
            min-width: 100px;
            text-align: center;
        }
        
        .match-result {
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .match-result.win {
            background: rgba(0, 255, 0, 0.1);
            color: #00ff00;
        }
        
        .match-result.loss {
            background: rgba(255, 0, 51, 0.1);
            color: var(--accent-red);
        }
        
        .match-result.ot {
            background: rgba(255, 165, 0, 0.1);
            color: #ffa500;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .stat-card {
            background: linear-gradient(145deg, var(--metal-light), var(--metal-darker));
            border: 1px solid var(--metal-border);
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            border-color: var(--accent-red);
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 3rem;
            font-weight: bold;
            color: var(--accent-red);
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: var(--text-gray);
            font-size: 1.1rem;
        }
        
        .team-cell {
            display: flex;
            align-items: center;
        }
        
        .team-logo {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 10px;
            border: 1px solid var(--metal-border);
        }
        
        .team-name {
            font-weight: 600;
        }
        
        .last-games {
            display: flex;
            gap: 5px;
        }
        
        .game-result {
            width: 25px;
            height: 25px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        .game-result.win {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
        }
        
        .game-result.loss {
            background: rgba(255, 0, 51, 0.2);
            color: var(--accent-red);
        }
        
        .game-result.ot-loss {
            background: rgba(255, 165, 0, 0.2);
            color: #ffa500;
        }
        
        .standings-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .standings-table th {
            background: linear-gradient(to right, var(--metal-darker), var(--metal-light));
            color: var(--text-white);
            padding: 15px;
            text-align: left;
            border-bottom: 3px solid var(--accent-red);
        }
        
        .standings-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--metal-border);
            color: var(--text-gray);
        }
        
        .standings-table tr:hover td {
            background-color: rgba(255, 0, 51, 0.05);
            color: var(--text-white);
        }
        
        .standings-table td:nth-child(9) {
            color: var(--accent-red) !important;
            font-weight: bold !important;
            font-size: 1.1rem;
            background: rgba(255, 0, 51, 0.05);
        }
        
        .playoff-qualified {
            background: linear-gradient(90deg, rgba(255, 0, 51, 0.1), rgba(255, 0, 51, 0.05));
            border-left: 3px solid var(--accent-red);
        }
        
        /* ИСПРАВЛЕНИЕ: Первое место должно быть самым ярким */
        .playoff-qualified:first-child {
            background: linear-gradient(90deg, rgba(255, 0, 51, 0.3), rgba(255, 0, 51, 0.15));
            border-left: 4px solid #ff0033;
            color: var(--text-white) !important;
        }
        
        .playoff-qualified:first-child td {
            color: var(--text-white) !important;
            font-weight: bold;
        }
        
        .card {
            background: linear-gradient(145deg, var(--metal-light), var(--metal-darker));
            border: 1px solid var(--metal-border);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 1.8rem;
            color: var(--text-white);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: var(--accent-red);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            padding: 20px;
        }
        
        .modal-content {
            background: linear-gradient(145deg, var(--metal-dark), var(--metal-darker));
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            border: 3px solid var(--accent-red);
            box-shadow: var(--glow-red);
            position: relative;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--text-white);
            font-size: 1.8rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .modal-close:hover {
            color: var(--accent-red);
        }
        
        .image-upload {
            border: 2px dashed var(--metal-border);
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .image-upload:hover {
            border-color: var(--accent-blue);
            background: rgba(0, 102, 255, 0.05);
        }
        
        .upload-icon {
            font-size: 3rem;
            color: var(--accent-blue);
            margin-bottom: 10px;
        }
        
        .uploaded-image {
            max-width: 200px;
            max-height: 150px;
            object-fit: contain;
            margin-top: 15px;
            border-radius: 8px;
            display: none;
        }
        
        .password-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .password-modal {
            background: linear-gradient(145deg, var(--metal-darker), var(--metal-dark));
            border-radius: 15px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            border: 3px solid var(--accent-red);
            box-shadow: var(--glow-red);
            text-align: center;
            position: relative;
        }
        
        .password-logo {
            font-size: 3rem;
            color: var(--accent-red);
            margin-bottom: 20px;
        }
        
        .password-title {
            font-size: 1.5rem;
            color: var(--text-white);
            margin-bottom: 20px;
        }
        
        .password-input {
            width: 100%;
            padding: 15px;
            background: var(--metal-light);
            border: 2px solid var(--metal-border);
            border-radius: 8px;
            color: var(--text-white);
            font-size: 1rem;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .password-error {
            color: var(--accent-red);
            margin-bottom: 15px;
            display: none;
        }
        
        .edit-team-modal {
            background: linear-gradient(145deg, var(--metal-dark), var(--metal-darker));
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            border: 3px solid var(--accent-blue);
            box-shadow: 0 0 15px rgba(0, 102, 255, 0.7);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .edit-team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--accent-blue);
        }
        
        .edit-team-header h3 {
            color: var(--text-white);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .gradient-border-left {
            position: relative;
        }
        
        .gradient-border-left::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, var(--accent-red), var(--accent-blue));
            border-radius: 12px 0 0 12px;
        }
        
        .card.gradient-border-left,
        .text-card.gradient-border-left,
        .secondary-tournament-card.gradient-border-left,
        .admin-section.gradient-border-left {
            padding-left: 30px;
        }
        
        .test-connection-btn {
            background: linear-gradient(145deg, #00cc66, #009944);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-left: 10px;
        }
        
        .test-connection-btn:hover {
            background: linear-gradient(145deg, #00ff77, #00cc66);
            transform: translateY(-2px);
        }
        
        .connection-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-left: 15px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .connection-status.connected {
            background: rgba(0, 255, 0, 0.1);
            color: #00ff00;
            border: 1px solid rgba(0, 255, 0, 0.3);
        }
        
        .connection-status.disconnected {
            background: rgba(255, 0, 51, 0.1);
            color: var(--accent-red);
            border: 1px solid rgba(255, 0, 51, 0.3);
        }
        
        /* Стиль для крестика выхода */
        .password-modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--text-white);
            font-size: 1.8rem;
            cursor: pointer;
            transition: color 0.3s ease;
            z-index: 2001;
        }
        
        .password-modal-close:hover {
            color: var(--accent-red);
        }
        
        /* Стили для кнопок управления матчами */
        .match-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        
        .match-action-btn {
            padding: 5px 10px;
            font-size: 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            border: none;
            display: flex;
            align-items: center;
            gap: 3px;
            transition: all 0.3s ease;
        }
        
        .match-action-btn.simulate {
            background: linear-gradient(145deg, #00cc66, #009944);
            color: white;
        }
        
        .match-action-btn.simulate:hover {
            background: linear-gradient(145deg, #00ff77, #00cc66);
        }
        
        .match-action-btn.reset {
            background: linear-gradient(145deg, #ff9900, #cc7700);
            color: white;
        }
        
        .match-action-btn.reset:hover {
            background: linear-gradient(145deg, #ffaa00, #ff9900);
        }
        
        .match-action-btn.delete {
            background: linear-gradient(145deg, #ff4444, #cc0000);
            color: white;
        }
        
        .match-action-btn.delete:hover {
            background: linear-gradient(145deg, #ff6666, #ff4444);
        }
        
        /* Стили для управления таблицей */
        .standings-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .team-stats-reset-btn {
            background: linear-gradient(145deg, #ff9900, #cc7700);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s ease;
        }
        
        .team-stats-reset-btn:hover {
            background: linear-gradient(145deg, #ffaa00, #ff9900);
            transform: translateY(-2px);
        }
        
        .admin-match-card {
            background: linear-gradient(145deg, var(--metal-light), var(--metal-darker));
            border: 1px solid var(--metal-border);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .admin-match-card:hover {
            border-color: var(--accent-red);
        }
        
        .admin-match-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .admin-match-controls {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        
        .score-input {
            width: 50px;
            padding: 5px;
            background: var(--metal-dark);
            border: 1px solid var(--metal-border);
            border-radius: 4px;
            color: var(--text-white);
            text-align: center;
        }
        
        .edit-news-modal {
            background: linear-gradient(145deg, var(--metal-dark), var(--metal-darker));
            border-radius: 15px;
            padding: 30px;
            max-width: 700px;
            width: 100%;
            border: 3px solid var(--accent-blue);
            box-shadow: 0 0 15px rgba(0, 102, 255, 0.7);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        /* ИСПРАВЛЕНИЕ 3: Серии плей-офф градиентом от синего до фиолетового */
        .playoff-bracket {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .playoff-round {
            flex: 1;
            padding: 20px;
            border: 1px solid var(--metal-border);
            border-radius: 8px;
            margin: 0 10px;
            background: linear-gradient(145deg, rgba(0, 51, 102, 0.3), rgba(102, 0, 204, 0.3));
        }
        
        .playoff-round-title {
            text-align: center;
            color: var(--accent-red);
            font-size: 1.2rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--metal-border);
        }
        
        .playoff-series {
            background: linear-gradient(145deg, rgba(0, 102, 255, 0.2), rgba(102, 0, 204, 0.2)) !important;
            border: 3px solid #0066ff !important;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .playoff-series::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(0, 102, 255, 0.3), rgba(102, 0, 204, 0.3));
            z-index: 0;
        }
        
        .playoff-series:hover {
            border-color: #3399ff !important;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 102, 255, 0.4) !important;
            background: linear-gradient(145deg, rgba(0, 102, 255, 0.3), rgba(102, 0, 204, 0.3)) !important;
        }
        
        .playoff-series > * {
            position: relative;
            z-index: 1;
        }
        
        .playoff-series-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .playoff-series-title {
            color: var(--text-white);
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .playoff-series-score {
            background: linear-gradient(145deg, #0066ff, #6600cc) !important;
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .playoff-team {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            padding: 8px;
            border-radius: 4px;
            transition: background 0.3s ease;
            background: rgba(0, 0, 0, 0.3);
        }
        
        .playoff-team.winner {
            background: rgba(0, 255, 0, 0.2);
            border-left: 3px solid #00ff00;
        }
        
        .playoff-team.loser {
            background: rgba(255, 0, 51, 0.2);
            border-left: 3px solid var(--accent-red);
        }
        
        .playoff-team-logo {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
            border: 1px solid var(--metal-border);
        }
        
        .playoff-team-name {
            flex: 1;
            color: var(--text-white);
        }
        
        .playoff-team-wins {
            background: var(--metal-border);
            color: var(--text-white);
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        /* Модальное окно для матчей серии плей-офф */
        .playoff-series-modal {
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .playoff-series-matches {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .playoff-match-card {
            background: linear-gradient(145deg, var(--metal-darker), rgba(0, 51, 102, 0.2));
            border: 1px solid var(--metal-border);
            border-radius: 8px;
            padding: 15px;
        }
        
        .playoff-match-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            color: var(--text-gray);
            font-size: 0.9rem;
        }
        
        .playoff-match-number {
            color: var(--accent-blue);
            font-weight: bold;
        }
        
        .playoff-match-body {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .playoff-match-team {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .playoff-match-team-home {
            justify-content: flex-start;
        }
        
        .playoff-match-team-away {
            justify-content: flex-end;
            flex-direction: row-reverse;
        }
        
        .playoff-match-team-logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 0 15px;
            object-fit: cover;
        }
        
        .playoff-match-score-input {
            width: 60px;
            padding: 8px;
            background: var(--metal-dark);
            border: 1px solid var(--metal-border);
            border-radius: 4px;
            color: var(--text-white);
            text-align: center;
            font-size: 1.2rem;
        }
        
        .playoff-match-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }
        
        .playoff-series-info {
            background: linear-gradient(145deg, rgba(0, 51, 102, 0.2), rgba(102, 0, 204, 0.2));
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent-blue);
        }
        
        .playoff-series-status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .status-in-progress {
            background: rgba(255, 165, 0, 0.1);
            color: #ffa500;
            border: 1px solid rgba(255, 165, 0, 0.3);
        }
        
        .status-completed {
            background: rgba(0, 255, 0, 0.1);
            color: #00ff00;
            border: 1px solid rgba(0, 255, 0, 0.3);
        }
        
        .status-not-started {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-gray);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        /* ИСПРАВЛЕНИЕ 1 и 2: Стиль для кнопки редактирования счета в календаре */
        .match-edit-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(145deg, rgba(0, 102, 255, 0.8), rgba(102, 0, 204, 0.8));
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            z-index: 10;
            transition: all 0.3s ease;
            opacity: 0;
        }
        
        .match-card:hover .match-edit-btn {
            opacity: 1;
        }
        
        .match-edit-btn:hover {
            background: linear-gradient(145deg, #0066ff, #6600cc);
            transform: scale(1.1);
        }
        
        /* Дополнительные стили для модального окна редактирования матча */
        .match-edit-modal {
            max-width: 500px;
        }
        
        .match-edit-teams {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .match-edit-team {
            text-align: center;
            flex: 1;
        }
        
        .match-edit-team-logo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 10px;
            object-fit: cover;
            border: 2px solid var(--metal-border);
        }
        
        .match-edit-team-name {
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .match-edit-scores {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .match-edit-score-input {
            width: 80px;
            padding: 10px;
            background: var(--metal-dark);
            border: 2px solid var(--metal-border);
            border-radius: 8px;
            color: var(--text-white);
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .match-edit-colon {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-red);
        }
        
        /* PWA установка приложения */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: linear-gradient(145deg, var(--accent-blue-dark), var(--accent-blue));
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            display: none;
            align-items: center;
            animation: slideIn 0.3s ease;
            max-width: 300px;
        }
        
        .install-prompt button {
            background: var(--metal-darker);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.3s ease;
        }
        
        .install-prompt button:hover {
            background: var(--metal-light);
        }
    </style>
</head>
<body>
    <!-- Уведомление об установке PWA -->
    <div class="install-prompt" id="installPrompt">
        <div style="flex: 1;">
            <strong>Установите ДХЛ как приложение</strong>
            <div style="font-size: 0.9rem; margin-top: 5px;">Для быстрого доступа к лиге</div>
        </div>
        <button onclick="installPWA()">Установить</button>
        <button onclick="dismissInstallPrompt()" style="background: transparent; padding: 5px; margin-left: 5px;">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <div class="password-modal-overlay" id="passwordModal">
        <div class="password-modal">
            <button class="password-modal-close" onclick="closePasswordModal()">&times;</button>
            <div class="password-logo">
                <i class="fas fa-user-shield"></i>
            </div>
            <h2 class="password-title">Доступ к админ-панели</h2>
            <input type="password" class="password-input" id="adminPasswordInput" placeholder="Введите пароль" autocomplete="off">
            <div class="password-error" id="passwordError">Неверный пароль!</div>
            <button class="btn" onclick="checkAdminPassword()" style="width: 100%;">
                <i class="fas fa-unlock"></i> Войти
            </button>
            <div style="margin-top: 20px; color: var(--text-gray); font-size: 0.9rem;">
                <p>По умолчанию: <strong>admin123</strong></p>
                <p style="margin-top: 10px; font-size: 0.8rem;">Пароль можно изменить в настройках админ-панели</p>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="imageModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <img id="modalImage" src="" style="max-width: 100%; max-height: 80vh; display: block; margin: 0 auto;">
            <div style="text-align: center; margin-top: 15px;">
                <button class="btn btn-small" onclick="closeModal()">Закрыть</button>
            </div>
        </div>
    </div>
    
    <div class="news-modal-overlay" id="newsModal">
        <div class="news-modal">
            <div class="news-modal-header">
                <h2 id="newsModalTitle">Новость</h2>
                <button class="news-modal-close" onclick="closeNewsModal()">&times;</button>
            </div>
            <div class="news-modal-body">
                <img id="newsModalImage" class="news-modal-image" src="" alt="" style="display: none;">
                <div id="newsModalDate" class="news-modal-date"></div>
                <div id="newsModalContent" class="news-modal-content"></div>
                <div class="news-views" style="margin-top: 20px;">
                    <i class="fas fa-eye"></i>
                    <span id="newsModalViews">0</span> просмотров
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="editTeamModal">
        <div class="edit-team-modal">
            <div class="edit-team-header">
                <h3><i class="fas fa-edit"></i> Редактирование команды</h3>
                <button class="modal-close" onclick="closeEditTeamModal()">&times;</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">Название команды</label>
                <input type="text" class="form-input" id="editTeamName" placeholder="Название команды">
            </div>
            
            <div class="form-group">
                <label class="form-label">Логотип команды</label>
                <div class="image-upload" onclick="document.getElementById('editTeamLogoUpload').click()" id="editTeamLogoUploadArea">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <p>Нажмите для загрузки нового логотипа</p>
                    <p style="font-size: 0.9rem; color: var(--text-gray);">Оставьте пустым, чтобы сохранить текущий</p>
                    <img id="editTeamLogoPreview" class="uploaded-image" src="" alt="Превью логотипа">
                </div>
                <input type="file" id="editTeamLogoUpload" accept="image/*" style="display: none;" onchange="handleEditTeamLogoUpload(event)">
            </div>
            
            <div class="form-group">
                <label class="form-label">Статистика</label>
                <div style="background: var(--metal-light); padding: 15px; border-radius: 8px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                        <div>Игры: <strong id="editTeamGames">0</strong></div>
                        <div>Победы: <strong id="editTeamWins">0</strong></div>
                        <div>Победы ОТ: <strong id="editTeamOTWins">0</strong></div>
                        <div>Поражения ОТ: <strong id="editTeamOTLosses">0</strong></div>
                        <div>Поражения: <strong id="editTeamLosses">0</strong></div>
                        <div>Очки: <strong id="editTeamPoints">0</strong></div>
                    </div>
                    <div>Заброшено: <strong id="editTeamGoalsFor">0</strong></div>
                    <div>Пропущено: <strong id="editTeamGoalsAgainst">0</strong></div>
                </div>
            </div>
            
            <div class="btn-group" style="margin-top: 20px;">
                <button class="btn btn-blue" onclick="saveTeamEdit()">
                    <i class="fas fa-save"></i> Сохранить изменения
                </button>
                <button class="btn" onclick="closeEditTeamModal()">
                    <i class="fas fa-times"></i> Отмена
                </button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="editNewsModal">
        <div class="edit-news-modal">
            <div class="edit-team-header">
                <h3><i class="fas fa-edit"></i> Редактирование новости</h3>
                <button class="modal-close" onclick="closeEditNewsModal()">&times;</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">Заголовок новости</label>
                <input type="text" class="form-input" id="editNewsTitle" placeholder="Заголовок новости">
            </div>
            
            <div class="form-group">
                <label class="form-label">Текст новости</label>
                <textarea class="form-textarea" id="editNewsContent" rows="5" placeholder="Текст новости..."></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">Изображение новости</label>
                <div class="image-upload" onclick="document.getElementById('editNewsImageUpload').click()" id="editNewsImageUploadArea">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <p>Нажмите для загрузки нового изображения</p>
                    <p style="font-size: 0.9rem; color: var(--text-gray);">Оставьте пустым, чтобы сохранить текущее</p>
                    <img id="editNewsImagePreview" class="uploaded-image" src="" alt="Превью изображения">
                </div>
                <input type="file" id="editNewsImageUpload" accept="image/*" style="display: none;" onchange="handleEditNewsImageUpload(event)">
            </div>
            
            <div class="btn-group" style="margin-top: 20px;">
                <button class="btn btn-blue" onclick="saveNewsEdit()">
                    <i class="fas fa-save"></i> Сохранить изменения
                </button>
                <button class="btn" onclick="closeEditNewsModal()">
                    <i class="fas fa-times"></i> Отмена
                </button>
            </div>
        </div>
    </div>
    
    <!-- Модальное окно для матчей серии плей-офф -->
    <div class="modal-overlay" id="playoffSeriesModal">
        <div class="modal-content playoff-series-modal">
            <button class="modal-close" onclick="closePlayoffSeriesModal()">&times;</button>
            <div class="edit-team-header">
                <h3><i class="fas fa-hockey-puck"></i> Матчи серии плей-офф</h3>
            </div>
            
            <div class="playoff-series-info">
                <h4 id="playoffSeriesTitle">Серия 1</h4>
                <div id="playoffSeriesStatus" class="playoff-series-status status-not-started">Не начата</div>
                <div id="playoffSeriesScore" style="margin-top: 10px; font-size: 1.2rem; color: var(--accent-red); font-weight: bold;">0 - 0</div>
                <div id="playoffSeriesProgress" style="margin-top: 5px; color: var(--text-gray); font-size: 0.9rem;"></div>
            </div>
            
            <div class="playoff-series-matches" id="playoffSeriesMatches">
                <!-- Матчи будут добавлены динамически -->
            </div>
            
            <div class="playoff-match-actions">
                <button class="btn btn-small" onclick="simulateAllPlayoffSeriesGames()">
                    <i class="fas fa-play"></i> Симулировать все матчи
                </button>
                <button class="btn btn-small" onclick="resetPlayoffSeries()">
                    <i class="fas fa-undo"></i> Сбросить серию
                </button>
                <button class="btn btn-small btn-blue" onclick="savePlayoffSeries()">
                    <i class="fas fa-save"></i> Сохранить изменения
                </button>
            </div>
        </div>
    </div>
    
    <!-- Модальное окно для редактирования счета матча -->
    <div class="modal-overlay" id="editMatchModal">
        <div class="modal-content match-edit-modal">
            <button class="modal-close" onclick="closeEditMatchModal()">&times;</button>
            <div class="edit-team-header">
                <h3><i class="fas fa-edit"></i> Редактирование счета матча</h3>
            </div>
            
            <div class="form-group">
                <div class="match-edit-teams">
                    <div class="match-edit-team">
                        <div id="editMatchHomeTeamName" class="match-edit-team-name"></div>
                        <img id="editMatchHomeTeamLogo" class="match-edit-team-logo" src="" alt="">
                    </div>
                    
                    <div class="match-edit-scores">
                        <input type="number" id="editMatchHomeScore" class="match-edit-score-input" min="0" value="0">
                        <div class="match-edit-colon">:</div>
                        <input type="number" id="editMatchAwayScore" class="match-edit-score-input" min="0" value="0">
                    </div>
                    
                    <div class="match-edit-team">
                        <div id="editMatchAwayTeamName" class="match-edit-team-name"></div>
                        <img id="editMatchAwayTeamLogo" class="match-edit-team-logo" src="" alt="">
                    </div>
                </div>
                
                <div style="margin-bottom: 20px; text-align: center;">
                    <div style="color: var(--text-gray); margin-bottom: 10px;" id="editMatchDate"></div>
                    <div style="color: var(--accent-blue); font-weight: bold;" id="editMatchRound"></div>
                </div>
                
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: flex; align-items: center; gap: 10px; color: var(--text-gray);">
                        <input type="checkbox" id="editMatchOvertime"> Матч завершился в овертайме
                    </label>
                </div>
                
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: flex; align-items: center; gap: 10px; color: var(--text-gray);">
                        <input type="checkbox" id="editMatchCompleted"> Матч завершен
                    </label>
                </div>
                
                <div class="btn-group" style="justify-content: center;">
                    <button class="btn btn-blue" onclick="saveCalendarMatchScore()">
                        <i class="fas fa-save"></i> Сохранить счет
                    </button>
                    <button class="btn" onclick="simulateCalendarMatch()" style="margin-left: 10px;">
                        <i class="fas fa-play"></i> Симулировать
                    </button>
                    <button class="btn" onclick="closeEditMatchModal()" style="margin-left: 10px;">
                        <i class="fas fa-times"></i> Отмена
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="loader" id="globalLoader"></div>
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Уведомление</span>
    </div>
    
    <div class="admin-toggle pulse" id="adminToggle" onclick="accessAdminFromLogo()">
        <i class="fas fa-cogs"></i>
    </div>
    
    <div class="admin-panel" id="adminPanel">
        <div class="admin-header">
            <div>
                <h2><i class="fas fa-user-shield"></i> Административная панель</h2>
                <p style="color: var(--text-gray); margin-top: 5px;">Управление лигой ДХЛ</p>
            </div>
            <div style="display: flex; gap: 10px;">
                <div class="admin-position-toggle" onclick="toggleAdminPanelPosition()" title="Переместить панель на левую сторону">
                    <i class="fas fa-exchange-alt"></i>
                </div>
                <button class="btn btn-small" onclick="exitAdminPanel()" title="Закрыть панель, остаться админом">
                    <i class="fas fa-times"></i>
                </button>
                <button class="btn btn-small" onclick="logoutAdmin()" title="Выйти полностью" style="background: var(--accent-red-dark);">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
        
        <div class="admin-tabs-container">
            <div class="admin-tabs">
                <div class="admin-tab active" data-tab="firebase" onclick="switchAdminTab('firebase')">Firebase</div>
                <div class="admin-tab" data-tab="teams" onclick="switchAdminTab('teams')">Команды</div>
                <div class="admin-tab" data-tab="matches" onclick="switchAdminTab('matches')">Матчи</div>
                <div class="admin-tab" data-tab="playoff" onclick="switchAdminTab('playoff')">Плей-офф</div>
                <div class="admin-tab" data-tab="news" onclick="switchAdminTab('news')">Новости</div>
                <div class="admin-tab" data-tab="content" onclick="switchAdminTab('content')">Контент</div>
                <div class="admin-tab" data-tab="security" onclick="switchAdminTab('security')">Безопасность</div>
                <div class="admin-tab" data-tab="imageHosting" onclick="switchAdminTab('imageHosting')">Изображения</div>
            </div>
        </div>
        
        <div class="admin-content">
            <div class="admin-section gradient-border-left" id="teamsTab" style="display: none;">
                <h3><i class="fas fa-users"></i> Управление командами</h3>
                
                <div class="form-group">
                    <label class="form-label">Добавить новую команду</label>
                    <input type="text" class="form-input" id="newTeamName" placeholder="Название команды">
                    
                    <label class="form-label" style="margin-top: 15px;">Логотип команды</label>
                    <div class="image-upload" onclick="document.getElementById('teamLogoUpload').click()" id="teamLogoUploadArea">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <p>Нажмите для загрузки логотипа</p>
                        <p style="font-size: 0.9rem; color: var(--text-gray);">Рекомендуемый размер: 200x200 пикселей</p>
                        <img id="teamLogoPreview" class="uploaded-image" src="" alt="Превью логотипа">
                    </div>
                    <input type="file" id="teamLogoUpload" accept="image/*" style="display: none;" onchange="handleTeamLogoUpload(event)">
                    
                    <div style="margin-top: 20px;">
                        <button class="btn" onclick="addTeam()" id="addTeamBtn">
                            <i class="fas fa-plus-circle"></i> Добавить команду
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4 style="margin-bottom: 15px; color: var(--text-white);">Список команд (всего: <span id="teamsCount">0</span>)</h4>
                    <div id="teamsList"></div>
                </div>
            </div>
            
            <div class="admin-section gradient-border-left" id="newsTab" style="display: none;">
                <h3><i class="fas fa-newspaper"></i> Управление новостями</h3>
                
                <div class="form-group">
                    <label class="form-label">Добавить новость</label>
                    <input type="text" class="form-input" id="newsTitle" placeholder="Заголовок новости">
                    
                    <label class="form-label" style="margin-top: 15px;">Текст новости</label>
                    <textarea class="form-textarea" id="newsContent" rows="5" placeholder="Текст новости..."></textarea>
                    
                    <label class="form-label" style="margin-top: 15px;">Изображение новости</label>
                    <div class="image-upload" onclick="document.getElementById('newsImageUpload').click()" id="newsImageUploadArea">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <p>Нажмите для загрузки изображения</p>
                        <img id="newsImagePreview" class="uploaded-image" src="" alt="Превью изображения">
                    </div>
                    <input type="file" id="newsImageUpload" accept="image/*" style="display: none;" onchange="handleNewsImageUpload(event)">
                    
                    <div style="margin-top: 20px;">
                        <button class="btn" onclick="addNews()" id="addNewsBtn">
                            <i class="fas fa-plus-circle"></i> Добавить новость
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4 style="margin-bottom: 15px; color: var(--text-white);">Список новостей (всего: <span id="newsCount">0</span>)</h4>
                    <div id="adminNewsList"></div>
                </div>
            </div>
            
            <div class="admin-section gradient-border-left" id="contentTab" style="display: none;">
                <h3><i class="fas fa-edit"></i> Управление контентом</h3>
                
                <div class="form-group">
                    <label class="form-label">Название лиги</label>
                    <input type="text" class="form-input" id="leagueName" placeholder="ДХЛ - Драконья Хоккейная Лига">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Описание лиги</label>
                    <textarea class="form-textarea" id="leagueDescription" rows="4" placeholder="Описание лиги..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Логотип лиги</label>
                    <div class="image-upload" onclick="document.getElementById('leagueLogoUpload').click()" id="leagueLogoUploadArea">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <p>Нажмите для загрузки логотипа лиги</p>
                        <img id="leagueLogoPreview" class="uploaded-image" src="" alt="Превью логотипа лиги">
                    </div>
                    <input type="file" id="leagueLogoUpload" accept="image/*" style="display: none;" onchange="handleLeagueLogoUpload(event)">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Текст на главной странице</label>
                    <textarea class="form-textarea" id="homepageText" rows="6" placeholder="Текст для главной страницы..."></textarea>
                </div>
                
                <div style="margin-top: 20px;">
                    <button class="btn" onclick="saveContentChanges()">
                        <i class="fas fa-save"></i> Сохранить все изменения
                    </button>
                    <button class="btn btn-blue" onclick="syncContentToFirebase()" style="margin-left: 10px;">
                        <i class="fas fa-cloud-upload-alt"></i> Синхронизировать
                    </button>
                </div>
            </div>
            
            <div class="admin-section gradient-border-left" id="firebaseTab">
                <h3><i class="fas fa-database"></i> Настройка Firebase</h3>
                <div class="form-group">
                    <label class="form-label">Конфигурация Firebase</label>
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        <span id="firebaseStatus" class="connection-status disconnected">
                            <i class="fas fa-times-circle"></i> Не подключено
                        </span>
                    </div>
                    <textarea class="form-textarea" id="firebaseConfig" rows="8" placeholder='{
  "apiKey": "ваш_api_key",
  "authDomain": "ваш_auth_domain",
  "databaseURL": "ваш_database_url",
  "projectId": "ваш_project_id",
  "storageBucket": "ваш_storage_bucket",
  "messagingSenderId": "ваш_messaging_sender_id",
  "appId": "ваш_app_id"
}'></textarea>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-blue" onclick="saveFirebaseConfig()">
                        <i class="fas fa-save"></i> Сохранить конфигурацию
                    </button>
                    <button class="test-connection-btn" onclick="testFirebaseConnection()">
                        <i class="fas fa-plug"></i> Проверить подключение
                    </button>
                </div>
            </div>
            
            <div class="admin-section gradient-border-left" id="matchesTab" style="display: none;">
                <h3><i class="fas fa-hockey-puck"></i> Управление матчами</h3>
                
                <div class="form-group">
                    <h4>Симуляция матчей</h4>
                    <p style="color: var(--text-gray); margin-bottom: 15px;">Сгенерируйте календарь и результаты матчей для текущего сезона</p>
                    
                    <div class="btn-group">
                        <button class="btn btn-blue" onclick="generateRandomCalendar()" id="generateCalendarBtn">
                            <i class="fas fa-calendar-plus"></i> Сгенерировать случайный календарь
                        </button>
                        <button class="btn" onclick="simulateAllMatches()">
                            <i class="fas fa-play"></i> Сыграть все матчи
                        </button>
                        <button class="btn" onclick="resetAllMatches()" style="background: #ff4444;">
                            <i class="fas fa-undo"></i> Сбросить все матчи
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4>Редактирование результатов матчей</h4>
                    <p style="color: var(--text-gray); margin-bottom: 15px;">Изменяйте счета матчей в календаре ниже. Нажмите "Симулировать" для случайного результата</p>
                    
                    <div id="adminMatchesList"></div>
                </div>
                
                <div class="form-group">
                    <h4>Статистика сезона</h4>
                    <div style="background: var(--metal-light); padding: 15px; border-radius: 8px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div>Матчей запланировано: <strong id="scheduledMatchesCount">0</strong></div>
                            <div>Матчей сыграно: <strong id="playedMatchesCount">0</strong></div>
                            <div>Всего голов: <strong id="totalGoalsCount">0</strong></div>
                            <div>В овертайме: <strong id="overtimeMatchesCount">0</strong></div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4>Ручное добавление матча</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label class="form-label">Хозяева</label>
                            <select class="form-select" id="matchHomeTeam">
                                <option value="">Выберите команду</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Гости</label>
                            <select class="form-select" id="matchAwayTeam">
                                <option value="">Выберите команду</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                        <div class="form-group">
                            <label class="form-label">Голы хозяев</label>
                            <input type="number" class="form-input" id="matchHomeScore" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Голы гостей</label>
                            <input type="number" class="form-input" id="matchAwayScore" min="0" value="0">
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 15px;">
                        <label class="form-label">Овертайм?</label>
                        <label style="display: flex; align-items: center; gap: 10px; color: var(--text-gray);">
                            <input type="checkbox" id="matchOvertime"> Матч завершился в овертайме
                        </label>
                    </div>
                    
                    <button class="btn" onclick="addMatchManually()" style="margin-top: 20px;">
                        <i class="fas fa-plus-circle"></i> Добавить результат матча
                    </button>
                </div>
            </div>
            
            <div class="admin-section gradient-border-left" id="playoffTab" style="display: none;">
                <h3><i class="fas fa-trophy"></i> Управление плей-офф</h3>
                <div class="form-group">
                    <p style="color: var(--text-gray); margin-bottom: 15px;">Управление плей-офф "Кубок Холодного Пути". Автоматически выбираются первые 8 команд из турнирной таблицы.</p>
                    
                    <div style="margin-bottom: 20px;">
                        <button class="btn" onclick="generatePlayoffBracket()" id="generatePlayoffBtn">
                            <i class="fas fa-sitemap"></i> Сгенерировать сетку плей-офф
                        </button>
                        <button class="btn btn-blue" onclick="updatePlayoffTeams()" style="margin-left: 10px;">
                            <i class="fas fa-sync-alt"></i> Обновить команды из таблицы
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <h4>Статус плей-офф</h4>
                        <div style="background: var(--metal-light); padding: 15px; border-radius: 8px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div>Стадия: <strong id="playoffStage">Не начат</strong></div>
                                <div>Сыграно матчей: <strong id="playoffMatchesPlayed">0</strong></div>
                                <div>Всего матчей: <strong id="playoffTotalMatches">0</strong></div>
                                <div>Чемпион: <strong id="playoffChampion">Не определен</strong></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <h4>Управление сериями</h4>
                        <div id="adminPlayoffSeriesList"></div>
                    </div>
                </div>
            </div>
            
            <div class="admin-section gradient-border-left" id="securityTab" style="display: none;">
                <h3><i class="fas fa-shield-alt"></i> Настройки безопасности</h3>
                <div class="form-group">
                    <label class="form-label">Текущий пароль администратора</label>
                    <input type="password" class="form-input" value="admin123" disabled>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Новый пароль</label>
                    <input type="password" class="form-input" id="newPassword" placeholder="Введите новый пароль">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Подтверждение пароля</label>
                    <input type="password" class="form-input" id="confirmPassword" placeholder="Повторите новый пароль">
                </div>
                
                <button class="btn" onclick="changeAdminPassword()">
                    <i class="fas fa-key"></i> Изменить пароль
                </button>
            </div>
            
            <div class="admin-section gradient-border-left" id="imageHostingTab" style="display: none;">
                <h3><i class="fas fa-image"></i> Настройки хостинга изображений</h3>
                <div class="form-group">
                    <label class="form-label">API ключ ImgBB</label>
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        <span id="imgbbStatus" class="connection-status disconnected">
                            <i class="fas fa-times-circle"></i> Не подключено
                        </span>
                    </div>
                    <input type="text" class="form-input" id="imgbbApiKey" placeholder="Введите ваш API ключ ImgBB">
                </div>
                
                <div class="form-group">
                    <p style="color: var(--text-gray);">Для загрузки изображений используется ImgBB. Получите бесплатный API ключ на <a href="https://imgbb.com" target="_blank" style="color: var(--accent-blue);">imgbb.com</a></p>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-blue" onclick="saveImgbbConfig()">
                        <i class="fas fa-save"></i> Сохранить настройки
                    </button>
                    <button class="test-connection-btn" onclick="testImgbbConnection()">
                        <i class="fas fa-plug"></i> Проверить подключение
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="header">
        <div class="container">
            <div class="logo-section" onclick="accessAdminFromLogo()">
                <img id="mainLeagueLogo" src="" style="width: 60px; height: 60px; margin-right: 15px; display: none; border-radius: 50%; border: 3px solid var(--accent-red);">
                <i class="fas fa-dragon logo-icon" id="defaultLogoIcon"></i>
                <h1 class="logo-text" id="leagueTitle">ДХЛ - Драконья Хоккейная Лига</h1>
            </div>
            
            <div class="nav-tabs">
                <button class="nav-btn active" data-page="home" onclick="switchPage('homePage')">
                    <i class="fas fa-home"></i> Главная
                </button>
                <button class="nav-btn" data-page="standings" onclick="switchPage('standingsPage')">
                    <i class="fas fa-table"></i> Турнирная таблица
                </button>
                <button class="nav-btn" data-page="matches" onclick="switchPage('matchesPage')">
                    <i class="fas fa-calendar-alt"></i> Матчи
                </button>
                <button class="nav-btn" data-page="playoff" onclick="switchPage('playoffPage')">
                    <i class="fas fa-trophy"></i> Кубок Холодного Пути
                </button>
                <button class="nav-btn" data-page="news" onclick="switchPage('newsPage')">
                    <i class="fas fa-newspaper"></i> Новости
                </button>
                <button class="nav-btn" data-page="stats" onclick="switchPage('statsPage')">
                    <i class="fas fa-chart-bar"></i> Статистика
                </button>
            </div>
        </div>
    </div>
    
    <div class="container" id="mainContainer">
        <div class="page active" id="homePage">
            <div class="section-title">
                <i class="fas fa-home"></i> Обзор лиги
            </div>
            
            <div class="card gradient-border-left">
                <h3 id="leagueDescriptionText">Добро пожаловать в Драконью Хоккейную Лигу - самую экстремальную и зрелищную хоккейную лигу на планете!</h3>
                <p style="margin-top: 15px; color: var(--text-gray);" id="homepageContent">
                    16 команд сражаются за главный трофей - Кубок Холодного Пути. Каждая команда проводит по 22 матча в регулярном сезоне, после чего 8 лучших выходит в плей-офф. Следите за обновлениями, новостей и статистикой в реальном времени!
                </p>
                
                <div class="text-card gradient-border-left" id="homeText1">
                    <div class="text-card-header">
                        <div class="text-card-title">История лиги</div>
                        <button class="text-card-edit-btn" id="homeText1EditBtn" style="display: none;" onclick="editTextBlock('homeText1')">
                            <i class="fas fa-edit"></i> Редактировать
                        </button>
                    </div>
                    <div class="text-card-content" id="homeText1Content">
                        ДХЛ была основана в 2010 году как альтернатива традиционным хоккейным лигам. 
                        С тех пор она стала домом для самых отчаянных и талантливых команд, 
                        которые не боятся рисковать и показывают зрелищный хоккей.
                    </div>
                    <div class="text-editor" id="homeText1Editor">
                        <textarea id="homeText1Textarea" rows="4"></textarea>
                        <div class="text-editor-buttons">
                            <button class="btn btn-small" onclick="saveTextBlock('homeText1')">Сохранить</button>
                            <button class="btn btn-small" onclick="cancelEditText('homeText1')">Отмена</button>
                        </div>
                    </div>
                </div>
                
                <div class="text-card gradient-border-left" id="homeText2">
                    <div class="text-card-header">
                        <div class="text-card-title">Философия лиги</div>
                        <button class="text-card-edit-btn" id="homeText2EditBtn" style="display: none;" onclick="editTextBlock('homeText2')">
                            <i class="fas fa-edit"></i> Редактировать
                        </button>
                    </div>
                    <div class="text-card-content" id="homeText2Content">
                        Наша философия проста: хоккей должен быть быстрым, агрессивным и зрелищным. 
                        Мы поощряем творческий подход, индивидуальное мастерство и командный дух. 
                        Каждый матч - это битва, каждый сезон - это война за Кубок Холодного Пути.
                    </div>
                    <div class="text-editor" id="homeText2Editor">
                        <textarea id="homeText2Textarea" rows="4"></textarea>
                        <div class="text-editor-buttons">
                            <button class="btn btn-small" onclick="saveTextBlock('homeText2')">Сохранить</button>
                            <button class="btn btn-small" onclick="cancelEditText('homeText2')">Отмена</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section-title">
                <i class="fas fa-fire"></i> Топ команд
            </div>
            
            <div class="card gradient-border-left">
                <div id="topTeams"></div>
            </div>
            
            <div class="section-title">
                <i class="fas fa-bullhorn"></i> Последние новости
            </div>
            
            <div class="news-grid" id="latestNews"></div>
        </div>
        
        <div class="page" id="standingsPage">
            <div class="section-title">
                <i class="fas fa-table"></i> Турнирная таблица регулярного сезона
            </div>
            
            <div class="standings-controls" id="standingsControls" style="display: none;">
                <button class="team-stats-reset-btn" onclick="resetAllTeamsStats()">
                    <i class="fas fa-undo"></i> Сбросить статистику всех команд
                </button>
                <button class="btn btn-small" onclick="resetTournamentTable()" style="background: #ff4444;">
                    <i class="fas fa-trash"></i> Сбросить таблицу
                </button>
            </div>
            
            <div class="card gradient-border-left">
                <table class="standings-table" id="standingsTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Команда</th>
                            <th>И</th>
                            <th>В</th>
                            <th>ВО</th>
                            <th>ПО</th>
                            <th>П</th>
                            <th>Ш</th>
                            <th>О</th>
                            <th>Последние 5 игр</th>
                            <th id="standingsActionsHeader" style="display: none;">Действия</th>
                        </tr>
                    </thead>
                    <tbody id="standingsBody"></tbody>
                </table>
            </div>
        </div>
        
        <div class="page" id="matchesPage">
            <div class="section-title">
                <i class="fas fa-calendar-alt"></i> Календарь матчей
            </div>
            
            <div class="card gradient-border-left">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div>
                        <h3>Регулярный сезон ДХЛ</h3>
                        <p style="color: var(--text-gray);">Каждая команда играет с каждой дважды (дома и в гостях)</p>
                    </div>
                    <div>
                        <button class="btn btn-small" onclick="filterMatches('all')">Все матчи</button>
                        <button class="btn btn-small" onclick="filterMatches('upcoming')">Предстоящие</button>
                        <button class="btn btn-small" onclick="filterMatches('completed')">Завершенные</button>
                    </div>
                </div>
                
                <div class="matches-container" id="matchesContainer"></div>
            </div>
        </div>
        
        <div class="page" id="playoffPage">
            <div class="section-title">
                <i class="fas fa-trophy"></i> Кубок Холодного Пути - Плей-офф
            </div>
            
            <div class="card gradient-border-left">
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2>СЕТКА ПЛЕЙ-ОФФ ДХЛ</h2>
                    <p style="color: var(--text-gray); margin-top: 10px;">8 лучших команд сражаются за Кубок Холодного Пути</p>
                </div>
                
                <div class="playoff-bracket" id="playoffBracket">
                    <div style="text-align: center; padding: 40px; color: var(--text-gray);">
                        <i class="fas fa-trophy" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i>
                        <p>Плей-офф еще не начат</p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">Администратор может сгенерировать сетку плей-офф через админ-панель</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="page" id="newsPage">
            <div class="section-title">
                <i class="fas fa-newspaper"></i> Новости ДХЛ
            </div>
            
            <div class="news-grid" id="allNews"></div>
        </div>
        
        <div class="page" id="statsPage">
            <div class="section-title">
                <i class="fas fa-chart-bar"></i> Статистика лиги
            </div>
            
            <div class="stats-grid">
                <div class="stat-card gradient-border-left">
                    <div class="stat-value" id="totalGoals">0</div>
                    <div class="stat-label">Всего голов</div>
                </div>
                <div class="stat-card gradient-border-left">
                    <div class="stat-value" id="avgGoals">0.0</div>
                    <div class="stat-label">Среднее голов за матч</div>
                </div>
                <div class="stat-card gradient-border-left">
                    <div class="stat-value" id="totalMatchesPlayed">0</div>
                    <div class="stat-label">Сыграно матчей</div>
                </div>
                <div class="stat-card gradient-border-left">
                    <div class="stat-value" id="overtimeMatches">0</div>
                    <div class="stat-label">Матчей в овертайме</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ==================== ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ ====================
        
        // Firebase переменные
        let firebaseApp = null;
        let firebaseDatabase = null;
        let firebaseStorage = null;
        let isFirebaseConnected = false;
        let firebaseConfig = null;
        
        // PWA переменные
        let deferredPrompt = null;
        let isAppInstalled = false;
        
        // Проверка, загружены ли Firebase SDK
        function isFirebaseSDKLoaded() {
            return window.firebaseModules && 
                   typeof window.firebaseModules.initializeApp !== 'undefined' && 
                   typeof window.firebaseModules.getDatabase !== 'undefined';
        }
        
        // Данные лиги
        let leagueData = {
            name: "ДХЛ - Драконья Хоккейная Лига",
            description: "Добро пожаловать в Драконью Хоккейную Лигу - самую экстремальную и зрелищную хоккейную лигу на планете!",
            homepageText: "16 команд сражаются за главный трофей - Кубок Холодного Пути. Каждая команда проводит по 22 матча в регулярном сезоне, после чего 8 лучших выходит в плей-офф. Следите за обновлениями, новостей и статистикой в реальном времени!",
            teams: [],
            matches: [],
            news: [],
            stats: {
                totalGoals: 0,
                avgGoals: 0,
                totalMatches: 0,
                overtimeMatches: 0
            },
            playoff: {
                stage: "not_started", // not_started, first_round, second_round, final, finished
                champion: null,
                series: []
            },
            content: {
                leagueLogo: null,
                customTexts: {}
            },
            settings: {
                firebaseConfig: null,
                imgbbApiKey: null,
                adminPassword: "admin123"
            }
        };
        
        // Другие переменные
        let newsViews = {};
        let editingTextBlockId = null;
        let editingTeamId = null;
        let editingNewsId = null;
        let uploadedTeamLogoDataURL = null;
        let uploadedNewsImageDataURL = null;
        let uploadedLeagueLogoDataURL = null;
        let editTeamLogoDataURL = null;
        let editNewsImageDataURL = null;
        let isAdminAuthenticated = false;
        let currentPlayoffSeriesId = null;
        let editingMatchId = null;
        
        // ==================== PWA СИСТЕМА ====================
        
        // Регистрация Service Worker для PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('sw.js').then(function(registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
        
        // Событие установки PWA
        window.addEventListener('beforeinstallprompt', (e) => {
            // Предотвращаем автоматическое отображение подсказки
            e.preventDefault();
            deferredPrompt = e;
            
            // Проверяем, не установлено ли уже приложение
            if (!isAppInstalled) {
                setTimeout(() => {
                    showInstallPrompt();
                }, 3000);
            }
        });
        
        // Проверка установки приложения
        window.addEventListener('appinstalled', () => {
            console.log('PWA was installed');
            isAppInstalled = true;
            hideInstallPrompt();
            showNotification('ДХЛ успешно установлена как приложение!', 'success');
        });
        
        // Проверяем, установлено ли приложение
        if (window.matchMedia('(display-mode: standalone)').matches || 
            window.navigator.standalone === true) {
            isAppInstalled = true;
        }
        
        // Показать подсказку об установке
        function showInstallPrompt() {
            if (deferredPrompt && !isAppInstalled) {
                const installPrompt = document.getElementById('installPrompt');
                installPrompt.style.display = 'flex';
                
                // Скрыть через 15 секунд
                setTimeout(() => {
                    if (installPrompt.style.display !== 'none') {
                        installPrompt.style.display = 'none';
                    }
                }, 15000);
            }
        }
        
        // Скрыть подсказку об установке
        function hideInstallPrompt() {
            const installPrompt = document.getElementById('installPrompt');
            installPrompt.style.display = 'none';
        }
        
        // Установить PWA
        async function installPWA() {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                console.log('User accepted the install prompt');
            } else {
                console.log('User dismissed the install prompt');
            }
            
            deferredPrompt = null;
            hideInstallPrompt();
        }
        
        // Отклонить подсказку
        function dismissInstallPrompt() {
            hideInstallPrompt();
            localStorage.setItem('dhl_pwa_dismissed', 'true');
        }
        
        // ==================== ИСПРАВЛЕНИЕ СИСТЕМЫ МАТЧЕЙ ====================
        
        // Централизованное обновление всех компонентов интерфейса
        function forceRefreshAll() {
            updateUI();
            updateMatchesUI();
            updateEditableMatchesList();
            updateStandings();
            updateStats();
            
            // Обновляем статистику матчей
            updateMatchesStats();
            
            // Если открыта админ-панель с вкладкой матчей - обновляем список
            if (isAdminAuthenticated) {
                const activeTab = document.querySelector('.admin-tab.active');
                if (activeTab && activeTab.dataset.tab === 'matches') {
                    updateEditableMatchesList();
                }
            }
        }
        
        // ИСПРАВЛЕННАЯ ФУНКЦИЯ: Обновление статистики команд после изменения матча
        function updateTeamStats(match) {
            if (!match.completed) return;
            
            const homeTeam = leagueData.teams.find(t => t.id === match.homeTeamId);
            const awayTeam = leagueData.teams.find(t => t.id === match.awayTeamId);
            
            if (!homeTeam || !awayTeam) return;
            
            // Сначала обнуляем старые данные для пересчета
            homeTeam.games = 0;
            homeTeam.wins = 0;
            homeTeam.otWins = 0;
            homeTeam.otLosses = 0;
            homeTeam.losses = 0;
            homeTeam.goalsFor = 0;
            homeTeam.goalsAgainst = 0;
            homeTeam.points = 0;
            homeTeam.last5 = [];
            
            awayTeam.games = 0;
            awayTeam.wins = 0;
            awayTeam.otWins = 0;
            awayTeam.otLosses = 0;
            awayTeam.losses = 0;
            awayTeam.goalsFor = 0;
            awayTeam.goalsAgainst = 0;
            awayTeam.points = 0;
            awayTeam.last5 = [];
            
            // Собираем все завершенные матчи для обеих команд
            const homeTeamMatches = leagueData.matches.filter(m => 
                m.completed && (m.homeTeamId === homeTeam.id || m.awayTeamId === homeTeam.id)
            );
            
            const awayTeamMatches = leagueData.matches.filter(m => 
                m.completed && (m.homeTeamId === awayTeam.id || m.awayTeamId === awayTeam.id)
            );
            
            // Пересчитываем статистику для домашней команды
            homeTeamMatches.forEach(m => {
                homeTeam.games++;
                const isHome = m.homeTeamId === homeTeam.id;
                homeTeam.goalsFor += isHome ? m.homeScore : m.awayScore;
                homeTeam.goalsAgainst += isHome ? m.awayScore : m.homeScore;
                
                if (m.overtime) {
                    if ((isHome && m.homeScore > m.awayScore) || (!isHome && m.awayScore > m.homeScore)) {
                        homeTeam.otWins++;
                        homeTeam.points += 2;
                        homeTeam.last5.push('W');
                    } else {
                        homeTeam.otLosses++;
                        homeTeam.points += 1;
                        homeTeam.last5.push('OTL');
                    }
                } else {
                    if ((isHome && m.homeScore > m.awayScore) || (!isHome && m.awayScore > m.homeScore)) {
                        homeTeam.wins++;
                        homeTeam.points += 3;
                        homeTeam.last5.push('W');
                    } else {
                        homeTeam.losses++;
                        homeTeam.last5.push('L');
                    }
                }
            });
            
            // Пересчитываем статистику для гостевой команды
            awayTeamMatches.forEach(m => {
                awayTeam.games++;
                const isHome = m.homeTeamId === awayTeam.id;
                awayTeam.goalsFor += isHome ? m.homeScore : m.awayScore;
                awayTeam.goalsAgainst += isHome ? m.awayScore : m.homeScore;
                
                if (m.overtime) {
                    if ((isHome && m.homeScore > m.awayScore) || (!isHome && m.awayScore > m.homeScore)) {
                        awayTeam.otWins++;
                        awayTeam.points += 2;
                        awayTeam.last5.push('W');
                    } else {
                        awayTeam.otLosses++;
                        awayTeam.points += 1;
                        awayTeam.last5.push('OTL');
                    }
                } else {
                    if ((isHome && m.homeScore > m.awayScore) || (!isHome && m.awayScore > m.homeScore)) {
                        awayTeam.wins++;
                        awayTeam.points += 3;
                        awayTeam.last5.push('W');
                    } else {
                        awayTeam.losses++;
                        awayTeam.last5.push('L');
                    }
                }
            });
            
            // Ограничиваем last5 5 последними играми
            if (homeTeam.last5.length > 5) homeTeam.last5 = homeTeam.last5.slice(-5);
            if (awayTeam.last5.length > 5) awayTeam.last5 = awayTeam.last5.slice(-5);
            
            // Сохраняем изменения
            saveToLocalStorage();
            
            if (isFirebaseConnected) {
                saveDataToFirebase();
            }
            
            // Обновляем интерфейс
            updateStandings();
            updateTeamsList();
            
            return true;
        }
        
        // ИСПРАВЛЕННАЯ ФУНКЦИЯ: Сохранение счета матча из админ-панели
        function saveMatchScore(matchId) {
            const match = leagueData.matches.find(m => m.id === matchId);
            if (!match) return;
            
            const homeScore = parseInt(document.getElementById(`homeScore_${matchId}`).value) || 0;
            const awayScore = parseInt(document.getElementById(`awayScore_${matchId}`).value) || 0;
            const overtime = document.getElementById(`overtime_${matchId}`).checked;
            const completed = document.getElementById(`completed_${matchId}`).checked;
            
            // Проверка: если матч завершен и счет равный, должен быть овертайм
            if (completed && homeScore === awayScore && !overtime) {
                showNotification('При равном счете должен быть отмечен овертайм!', 'error');
                return;
            }
            
            // Сохраняем старый статус для проверки
            const wasCompleted = match.completed;
            
            // Обновляем данные матча
            match.homeScore = homeScore;
            match.awayScore = awayScore;
            match.overtime = overtime;
            match.completed = completed;
            
            // Если статус матча изменился или счет изменился, обновляем статистику
            if (wasCompleted !== completed || homeScore !== match.homeScore || awayScore !== match.awayScore) {
                // Обновляем статистику команд
                const success = updateTeamStats(match);
                
                if (!success) {
                    showNotification('Ошибка обновления статистики команд!', 'error');
                    return;
                }
            }
            
            // Обновляем весь интерфейс
            forceRefreshAll();
            
            showNotification('Счет матча успешно сохранен!', 'success');
        }
        
        // ИСПРАВЛЕННАЯ ФУНКЦИЯ: Сохранение счета матча из календаря
        function saveCalendarMatchScore() {
            if (!editingMatchId) return;
            
            const match = leagueData.matches.find(m => m.id === editingMatchId);
            if (!match) return;
            
            const homeScore = parseInt(document.getElementById('editMatchHomeScore').value) || 0;
            const awayScore = parseInt(document.getElementById('editMatchAwayScore').value) || 0;
            const overtime = document.getElementById('editMatchOvertime').checked;
            const completed = document.getElementById('editMatchCompleted').checked;
            
            // Проверка: если матч завершен и счет равный, должен быть овертайм
            if (completed && homeScore === awayScore && !overtime) {
                showNotification('При равном счете должен быть отмечен овертайм!', 'error');
                return;
            }
            
            // Сохраняем старый статус для проверки
            const wasCompleted = match.completed;
            
            // Обновляем данные матча
            match.homeScore = homeScore;
            match.awayScore = awayScore;
            match.overtime = overtime;
            match.completed = completed;
            
            closeEditMatchModal();
            
            // Если статус матча изменился или счет изменился, обновляем статистику
            if (wasCompleted !== completed || homeScore !== match.homeScore || awayScore !== match.awayScore) {
                // Обновляем статистику команд
                const success = updateTeamStats(match);
                
                if (!success) {
                    showNotification('Ошибка обновления статистики команд!', 'error');
                    return;
                }
            }
            
            // Обновляем весь интерфейс
            forceRefreshAll();
            
            showNotification('Счет матча успешно сохранен!', 'success');
        }
        
        // ИСПРАВЛЕННАЯ ФУНКЦИЯ: Симуляция одного матча
        function simulateSingleMatch(matchId) {
            const match = leagueData.matches.find(m => m.id === matchId);
            if (!match) return;
            
            // Генерируем случайный счет
            let homeScore = Math.floor(Math.random() * 5);
            let awayScore = Math.floor(Math.random() * 5);
            
            // 30% шанс на овертайм
            const isOvertime = Math.random() < 0.3;
            
            if (isOvertime && homeScore === awayScore) {
                if (Math.random() > 0.5) {
                    homeScore += 1;
                } else {
                    awayScore += 1;
                }
            } else if (homeScore === awayScore) {
                if (Math.random() > 0.5) {
                    homeScore += 1;
                } else {
                    awayScore += 1;
                }
            }
            
            // Сохраняем старый статус для проверки
            const wasCompleted = match.completed;
            
            match.homeScore = homeScore;
            match.awayScore = awayScore;
            match.overtime = isOvertime && homeScore !== awayScore;
            match.completed = true;
            
            // Обновляем поля ввода
            document.getElementById(`homeScore_${matchId}`).value = homeScore;
            document.getElementById(`awayScore_${matchId}`).value = awayScore;
            document.getElementById(`overtime_${matchId}`).checked = match.overtime;
            document.getElementById(`completed_${matchId}`).checked = true;
            document.getElementById(`homeScore_${matchId}`).disabled = false;
            document.getElementById(`awayScore_${matchId}`).disabled = false;
            
            // Обновляем статистику команд
            const success = updateTeamStats(match);
            
            if (!success) {
                showNotification('Ошибка обновления статистики команд!', 'error');
                return;
            }
            
            // Обновляем весь интерфейс
            forceRefreshAll();
            
            showNotification(`Матч симулирован: ${homeScore}:${awayScore}${match.overtime ? ' (ОТ)' : ''}`, 'success');
        }
        
        // ИСПРАВЛЕННАЯ ФУНКЦИЯ: Сброс матча
        function resetMatch(matchId) {
            const match = leagueData.matches.find(m => m.id === matchId);
            if (!match) return;
            
            // Сохраняем старый статус для проверки
            const wasCompleted = match.completed;
            const oldHomeScore = match.homeScore;
            const oldAwayScore = match.awayScore;
            
            match.homeScore = 0;
            match.awayScore = 0;
            match.overtime = false;
            match.completed = false;
            
            // Обновляем поля ввода
            document.getElementById(`homeScore_${matchId}`).value = 0;
            document.getElementById(`awayScore_${matchId}`).value = 0;
            document.getElementById(`overtime_${matchId}`).checked = false;
            document.getElementById(`completed_${matchId}`).checked = false;
            document.getElementById(`homeScore_${matchId}`).disabled = true;
            document.getElementById(`awayScore_${matchId}`).disabled = true;
            
            // Если матч был завершен, обновляем статистику команд
            if (wasCompleted) {
                const success = updateTeamStats(match);
                
                if (!success) {
                    showNotification('Ошибка обновления статистики команд!', 'error');
                    return;
                }
            }
            
            // Обновляем весь интерфейс
            forceRefreshAll();
            
            showNotification('Матч сброшен!', 'success');
        }
        
        // ИСПРАВЛЕННАЯ ФУНКЦИЯ: Сброс всех матчей
        function resetAllMatches() {
            if (!confirm('Вы уверены, что хотите сбросить все матчи? Это также сбросит статистику команд.')) {
                return;
            }
            
            // Сбрасываем статистику всех команд
            leagueData.teams.forEach(team => {
                resetTeamStats(team.id);
            });
            
            // Сбрасываем все матчи
            leagueData.matches.forEach(match => {
                match.homeScore = 0;
                match.awayScore = 0;
                match.overtime = false;
                match.completed = false;
            });
            
            // Обновляем весь интерфейс
            forceRefreshAll();
            
            showNotification('Все матчи сброшены! Статистика команд обновлена.', 'success');
        }
        
        // ИСПРАВЛЕННАЯ ФУНКЦИЯ: Симуляция всех матчей
        function simulateAllMatches() {
            if (leagueData.matches.length === 0) {
                showNotification('Сначала создайте календарь матчей!', 'error');
                return;
            }
            
            let simulatedCount = 0;
            
            // Сначала сбрасываем статистику всех команд
            leagueData.teams.forEach(team => {
                resetTeamStats(team.id);
            });
            
            // Симулируем все матчи
            leagueData.matches.forEach(match => {
                if (!match.completed) {
                    // Генерируем случайный счет
                    let homeScore = Math.floor(Math.random() * 5);
                    let awayScore = Math.floor(Math.random() * 5);
                    
                    // 30% шанс на овертайм
                    const isOvertime = Math.random() < 0.3;
                    
                    if (isOvertime && homeScore === awayScore) {
                        if (Math.random() > 0.5) {
                            homeScore += 1;
                        } else {
                            awayScore += 1;
                        }
                    } else if (homeScore === awayScore) {
                        if (Math.random() > 0.5) {
                            homeScore += 1;
                        } else {
                            awayScore += 1;
                        }
                    }
                    
                    match.homeScore = homeScore;
                    match.awayScore = awayScore;
                    match.overtime = isOvertime && homeScore !== awayScore;
                    match.completed = true;
                    simulatedCount++;
                    
                    // Обновляем статистику для этого матча
                    updateTeamStats(match);
                }
            });
            
            // Обновляем весь интерфейс
            forceRefreshAll();
            
            showNotification(`Успешно симулировано ${simulatedCount} матчей! Статистика обновлена.`, 'success');
        }
        
        // ==================== ИСПРАВЛЕННАЯ ФУНКЦИЯ СБРОСА ТАБЛИЦЫ ====================
        
        // ИСПРАВЛЕННАЯ ФУНКЦИЯ: Сброс всей турнирной таблицы
        function resetTournamentTable() {
            if (!confirm('Вы уверены, что хотите полностью сбросить турнирную таблицу? Это сбросит статистику ВСЕХ команд и ВСЕХ матчей!')) {
                return;
            }
            
            // Сбрасываем статистику всех команд
            leagueData.teams.forEach(team => {
                team.games = 0;
                team.wins = 0;
                team.otWins = 0;
                team.otLosses = 0;
                team.losses = 0;
                team.goalsFor = 0;
                team.goalsAgainst = 0;
                team.points = 0;
                team.last5 = [];
            });
            
            // Сбрасываем все матчи
            leagueData.matches.forEach(match => {
                match.homeScore = 0;
                match.awayScore = 0;
                match.overtime = false;
                match.completed = false;
            });
            
            // Принудительно сохраняем изменения
            saveToLocalStorage();
            
            if (isFirebaseConnected) {
                saveDataToFirebase();
            }
            
            // Обновляем ВЕСЬ интерфейс СРАЗУ
            forceRefreshAll();
            
            // Дополнительная проверка и обновление через небольшой таймаут
            setTimeout(() => {
                updateStandings();
                updateMatchesUI();
                updateStats();
                showNotification('Турнирная таблица полностью сброшена!', 'success');
            }, 100);
        }
        
        // ==================== ИСПРАВЛЕНИЕ ОТСУТСТВУЮЩИХ ФУНКЦИЙ ====================
        
        // ДОБАВЛЕНЫ ОТСУТСТВУЮЩИЕ ФУНКЦИИ ДЛЯ ЗАГРУЗКИ ИЗОБРАЖЕНИЙ:
        
        function handleTeamLogoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showNotification('Выберите файл изображения!', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedTeamLogoDataURL = e.target.result;
                const preview = document.getElementById('teamLogoPreview');
                preview.src = uploadedTeamLogoDataURL;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
        
        function handleNewsImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showNotification('Выберите файл изображения!', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedNewsImageDataURL = e.target.result;
                const preview = document.getElementById('newsImagePreview');
                preview.src = uploadedNewsImageDataURL;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
        
        function handleLeagueLogoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showNotification('Выберите файл изображения!', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedLeagueLogoDataURL = e.target.result;
                const preview = document.getElementById('leagueLogoPreview');
                preview.src = uploadedLeagueLogoDataURL;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
        
        function handleEditTeamLogoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showNotification('Выберите файл изображения!', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                editTeamLogoDataURL = e.target.result;
                const preview = document.getElementById('editTeamLogoPreview');
                preview.src = editTeamLogoDataURL;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
        
        function handleEditNewsImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showNotification('Выберите файл изображения!', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                editNewsImageDataURL = e.target.result;
                const preview = document.getElementById('editNewsImagePreview');
                preview.src = editNewsImageDataURL;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
        
        // ==================== ОСТАЛЬНЫЕ ФУНКЦИИ БЕЗ ИЗМЕНЕНИЙ ====================
        
        // Инициализация
        document.addEventListener('DOMContentLoaded', async function() {
            loadFromLocalStorage();
            loadNewsViews();
            
            if (leagueData.teams.length === 0) {
                initDefaultData();
            }
            
            // Загрузка конфигурации Firebase
            if (leagueData.settings.firebaseConfig) {
                try {
                    const config = JSON.parse(leagueData.settings.firebaseConfig);
                    document.getElementById('firebaseConfig').value = leagueData.settings.firebaseConfig;
                    await initFirebase(config);
                } catch (error) {
                    console.error('Ошибка загрузки конфигурации Firebase:', error);
                }
            }
            
            // Загрузка конфигурации ImgBB
            if (leagueData.settings.imgbbApiKey) {
                document.getElementById('imgbbApiKey').value = leagueData.settings.imgbbApiKey;
                document.getElementById('imgbbStatus').className = 'connection-status connected';
                document.getElementById('imgbbStatus').innerHTML = '<i class="fas fa-check-circle"></i> Настроено';
            }
            
            updateUI();
            updateTeamsList();
            updateNewsList();
            updateMatchesUI();
            updateEditableMatchesList();
            
            populateTeamSelects();
            fillAdminFields();
            
            // Проверяем, была ли отклонена подсказка об установке PWA
            const pwaDismissed = localStorage.getItem('dhl_pwa_dismissed');
            if (!pwaDismissed) {
                setTimeout(() => {
                    showInstallPrompt();
                }, 5000);
            }
            
            console.log('ДХЛ с исправленной системой матчей и PWA успешно загружена!');
        });
        
        // ОСТАВШАЯСЯ ЧАСТЬ КОДА (ВСЕ ФУНКЦИИ, КОТОРЫЕ НЕ БЫЛИ ПЕРЕОПРЕДЕЛЕНЫ ВЫШЕ)
        // ==================== FIREBASE СИСТЕМА ====================
        
        async function initFirebase(config) {
            try {
                showLoader('globalLoader', true);
                
                if (!isFirebaseSDKLoaded()) {
                    throw new Error('Библиотеки Firebase не загружены. Проверьте подключение к интернету и обновите страницу.');
                }
                
                if (!config || typeof config !== 'object') {
                    throw new Error('Конфигурация Firebase должна быть объектом JSON');
                }
                
                const requiredFields = ['apiKey', 'authDomain', 'databaseURL', 'projectId', 'storageBucket', 'messagingSenderId', 'appId'];
                for (const field of requiredFields) {
                    if (!config[field]) {
                        throw new Error(`В конфигурации отсутствует обязательное поле: ${field}`);
                    }
                }
                
                const { initializeApp, getDatabase, getStorage } = window.firebaseModules;
                firebaseApp = initializeApp(config);
                firebaseConfig = config;
                
                firebaseDatabase = getDatabase(firebaseApp);
                firebaseStorage = getStorage(firebaseApp);
                isFirebaseConnected = true;
                
                localStorage.setItem('dhl_firebase_config', JSON.stringify(config));
                updateFirebaseStatus();
                
                showNotification('Firebase успешно подключен!', 'success');
                
                try {
                    await loadDataFromFirebase();
                } catch (loadError) {
                    console.warn('Не удалось загрузить данные из Firebase:', loadError);
                    showNotification('Подключение установлено, но данные не загружены. Проверьте правила доступа базы данных.', 'info');
                }
                
                return true;
            } catch (error) {
                console.error('Ошибка инициализации Firebase:', error);
                isFirebaseConnected = false;
                updateFirebaseStatus();
                
                let errorMessage = 'Ошибка подключения к Firebase: ';
                errorMessage += error.message;
                
                showNotification(errorMessage, 'error');
                return false;
            } finally {
                showLoader('globalLoader', false);
            }
        }
        
        function saveFirebaseConfig() {
            const configText = document.getElementById('firebaseConfig').value.trim();
            
            if (!configText) {
                showNotification('Введите конфигурацию Firebase!', 'error');
                return;
            }
            
            try {
                const config = JSON.parse(configText);
                leagueData.settings.firebaseConfig = configText;
                saveToLocalStorage();
                showNotification('Конфигурация Firebase сохранена!', 'success');
                
                setTimeout(() => initFirebase(config), 1000);
                
            } catch (error) {
                showNotification('Неверный формат JSON конфигурации!', 'error');
            }
        }
        
        async function testFirebaseConnection() {
            const configText = document.getElementById('firebaseConfig').value.trim();
            
            if (!configText) {
                showNotification('Сначала сохраните конфигурацию Firebase!', 'error');
                return;
            }
            
            try {
                showLoader('globalLoader', true);
                const config = JSON.parse(configText);
                
                const success = await initFirebase(config);
                
                if (success) {
                    showNotification('Подключение к Firebase успешно!', 'success');
                }
                
            } catch (error) {
                showNotification('Ошибка подключения к Firebase: ' + error.message, 'error');
            } finally {
                showLoader('globalLoader', false);
            }
        }
        
        async function loadDataFromFirebase() {
            if (!isFirebaseConnected || !firebaseDatabase) {
                showNotification('Firebase не подключен!', 'error');
                return false;
            }
            
            try {
                showLoader('globalLoader', true);
                
                const { ref, onValue } = window.firebaseModules;
                const leagueRef = ref(firebaseDatabase, 'league');
                
                return new Promise((resolve, reject) => {
                    onValue(leagueRef, (snapshot) => {
                        const data = snapshot.val();
                        
                        if (data) {
                            // Сохраняем локальные настройки
                            const localSettings = { ...leagueData.settings };
                            leagueData = data;
                            leagueData.settings = { ...localSettings, ...data.settings };
                            
                            updateUI();
                            saveToLocalStorage();
                            showNotification('Данные загружены из Firebase!', 'success');
                            resolve(true);
                        } else {
                            showNotification('В Firebase нет данных.', 'info');
                            resolve(false);
                        }
                        
                        showLoader('globalLoader', false);
                    }, (error) => {
                        console.error('Ошибка загрузки из Firebase:', error);
                        showNotification('Ошибка загрузки из Firebase: ' + error.message, 'error');
                        showLoader('globalLoader', false);
                        reject(error);
                    });
                });
                
            } catch (error) {
                console.error('Ошибка загрузки из Firebase:', error);
                showNotification('Ошибка загрузки из Firebase: ' + error.message, 'error');
                showLoader('globalLoader', false);
                return false;
            }
        }
        
        async function saveDataToFirebase() {
            if (!isFirebaseConnected || !firebaseDatabase) {
                showNotification('Firebase не подключен!', 'error');
                return false;
            }
            
            try {
                showLoader('globalLoader', true);
                
                const { ref, set } = window.firebaseModules;
                const leagueRef = ref(firebaseDatabase, 'league');
                
                await set(leagueRef, leagueData);
                
                showNotification('Данные сохранены в Firebase!', 'success');
                return true;
            } catch (error) {
                console.error('Ошибка сохранения в Firebase:', error);
                showNotification('Ошибка сохранения в Firebase: ' + error.message, 'error');
                return false;
            } finally {
                showLoader('globalLoader', false);
            }
        }
        
        function syncContentToFirebase() {
            if (!isFirebaseConnected || !firebaseDatabase) {
                showNotification('Firebase не подключен! Проверьте настройки.', 'error');
                return;
            }
            
            try {
                showLoader('globalLoader', true);
                saveDataToFirebase();
                showNotification('Данные успешно синхронизированы с Firebase!', 'success');
            } catch (error) {
                console.error('Ошибка синхронизации с Firebase:', error);
                showNotification('Ошибка синхронизации: ' + error.message, 'error');
            } finally {
                showLoader('globalLoader', false);
            }
        }
        
        function updateFirebaseStatus() {
            const statusDiv = document.getElementById('firebaseStatus');
            
            if (!statusDiv) {
                console.error('Элемент firebaseStatus не найден в DOM');
                return;
            }
            
            if (isFirebaseConnected) {
                statusDiv.className = 'connection-status connected';
                statusDiv.innerHTML = '<i class="fas fa-check-circle"></i> Подключено к Firebase';
            } else {
                statusDiv.className = 'connection-status disconnected';
                statusDiv.innerHTML = '<i class="fas fa-times-circle"></i> Не подключено';
            }
        }
        
        // ==================== IMGBB СИСТЕМА ====================
        
        function saveImgbbConfig() {
            const apiKey = document.getElementById('imgbbApiKey').value.trim();
            if (!apiKey) {
                showNotification('Введите API ключ ImgBB!', 'error');
                return;
            }
            
            leagueData.settings.imgbbApiKey = apiKey;
            saveToLocalStorage();
            
            const statusDiv = document.getElementById('imgbbStatus');
            statusDiv.className = 'connection-status connected';
            statusDiv.innerHTML = '<i class="fas fa-check-circle"></i> Настроено';
            
            showNotification('API ключ ImgBB сохранен!', 'success');
        }
        
        async function testImgbbConnection() {
            const apiKey = document.getElementById('imgbbApiKey').value.trim();
            if (!apiKey) {
                showNotification('Введите API ключ ImgBB!', 'error');
                return;
            }
            
            try {
                showLoader('globalLoader', true);
                const statusElement = document.getElementById('imgbbStatus');
                statusElement.className = 'connection-status';
                statusElement.innerHTML = '<i class="fas fa-sync-alt"></i> Проверяем...';
                
                const canvas = document.createElement('canvas');
                canvas.width = 10;
                canvas.height = 10;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#ff0033';
                ctx.fillRect(0, 0, 10, 10);
                
                const testImage = canvas.toDataURL('image/png');
                const base64Data = testImage.replace(/^data:image\/(png|jpeg|jpg|gif);base64,/, '');
                
                const formData = new FormData();
                formData.append('key', apiKey);
                formData.append('image', base64Data);
                
                const response = await fetch('https://api.imgbb.com/1/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    statusElement.className = 'connection-status connected';
                    statusElement.innerHTML = '<i class="fas fa-check-circle"></i> Подключение успешно!';
                    showNotification(`ImgBB подключен!`, 'success');
                    leagueData.settings.imgbbApiKey = apiKey;
                    saveToLocalStorage();
                } else {
                    throw new Error(data.error?.message || 'Ошибка API');
                }
                
            } catch (error) {
                console.error('Ошибка теста ImgBB:', error);
                document.getElementById('imgbbStatus').className = 'connection-status disconnected';
                document.getElementById('imgbbStatus').innerHTML = '<i class="fas fa-times-circle"></i> Ошибка подключения';
                showNotification('Ошибка подключения к ImgBB: ' + error.message, 'error');
            } finally {
                showLoader('globalLoader', false);
            }
        }
        
        async function uploadImageToImgBB(imageFile, imageType = 'team') {
            const apiKey = leagueData.settings.imgbbApiKey;
            if (!apiKey) {
                showNotification('API ключ ImgBB не настроен!', 'error');
                throw new Error('API ключ не настроен');
            }
            
            const confirmed = confirm(`ВНИМАНИЕ!\n\nИзображение будет загружено на ПУБЛИЧНЫЙ хостинг ImgBB.\n\nЛюбой пользователь интернета сможет увидеть это изображение.\n\nПродолжить?`);
            if (!confirmed) {
                throw new Error('Пользователь отменил загрузку');
            }
            
            const compressedFile = await compressImageFile(imageFile);
            const base64 = await fileToBase64(compressedFile);
            const base64Data = base64.replace(/^data:image\/(png|jpeg|jpg|gif);base64,/, '');
            
            const formData = new FormData();
            formData.append('key', apiKey);
            formData.append('image', base64Data);
            
            try {
                showLoader('globalLoader', true);
                
                const response = await fetch('https://api.imgbb.com/1/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error?.message || 'Ошибка загрузки на ImgBB');
                }
                
                console.log('ImgBB upload successful:', {
                    url: data.data.url,
                    display_url: data.data.display_url,
                    delete_url: data.data.delete_url,
                    size: data.data.size
                });
                
                return data.data.url;
                
            } catch (error) {
                console.error('Ошибка загрузки на ImgBB:', error);
                showNotification(`Ошибка ImgBB: ${error.message}. Использую локальное хранилище.`, 'warning');
                return await compressToBase64(imageFile);
            } finally {
                showLoader('globalLoader', false);
            }
        }
        
        async function compressImageFile(file, maxWidth = 800, quality = 0.8) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        let width = img.width;
                        let height = img.height;
                        
                        if (width > maxWidth) {
                            const ratio = maxWidth / width;
                            width = maxWidth;
                            height = height * ratio;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        canvas.toBlob(function(blob) {
                            const compressedFile = new File([blob], file.name, {
                                type: 'image/jpeg',
                                lastModified: Date.now()
                            });
                            resolve(compressedFile);
                        }, 'image/jpeg', quality);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }
        
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        async function compressToBase64(file, maxWidth = 200, quality = 0.7) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > maxWidth) {
                        const ratio = maxWidth / width;
                        width = maxWidth;
                        height = height * ratio;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    resolve(canvas.toDataURL('image/jpeg', quality));
                };
                img.src = URL.createObjectURL(file);
            });
        }
        
        function dataURLtoFile(dataurl, filename) {
            const arr = dataurl.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            
            while(n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            
            return new File([u8arr], filename, { type: mime });
        }
        
        // ==================== ОСНОВНЫЕ ФУНКЦИИ ЛИГИ ====================
        
        function initDefaultData() {
            leagueData.teams = [
                { id: 1, name: "Арктические Волки", logo: null, games: 0, wins: 0, otWins: 0, otLosses: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, points: 0, last5: [] },
                { id: 2, name: "Стальные Медведи", logo: null, games: 0, wins: 0, otWins: 0, otLosses: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, points: 0, last5: [] },
                { id: 3, name: "Ледяные Драконы", logo: null, games: 0, wins: 0, otWins: 0, otLosses: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, points: 0, last5: [] },
                { id: 4, name: "Северные Валькирии", logo: null, games: 0, wins: 0, otWins: 0, otLosses: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, points: 0, last5: [] },
                { id: 5, name: "Тигры Тайги", logo: null, games: 0, wins: 0, otWins: 0, otLosses: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, points: 0, last5: [] },
                { id: 6, name: "Буревестники", logo: null, games: 0, wins: 0, otWins: 0, otLosses: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, points: 0, last5: [] },
                { id: 7, name: "Полярные Совы", logo: null, games: 0, wins: 0, otWins: 0, otLosses: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, points: 0, last5: [] },
                { id: 8, name: "Грозовые Ястребы", logo: null, games: 0, wins: 0, otWins: 0, otLosses: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, points: 0, last5: [] },
                { id: 9, name: "Вулканические Орлы", logo: null, games: 0, wins: 0, otWins: 0, otLosses: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, points: 0, last5: [] },
                { id: 10, name: "Морские Котики", logo: null, games: 0, wins: 0, otWins: 0, otLosses: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, points: 0, last5: [] },
                { id: 11, name: "Тундровые Рыси", logo: null, games: 0, wins: 0, otWins: 0, otLosses: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, points: 0, last5: [] },
                { id: 12, name: "Гималайские Барсы", logo: null, games: 0, wins: 0, otWins: 0, otLosses: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, points: 0, last5: [] },
                { id: 13, name: "Айсберг Акулы", logo: null, games: 0, wins: 0, otWins: 0, otLosses: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, points: 0, last5: [] },
                { id: 14, name: "Фьорд Киты", logo: null, games: 0, wins: 0, otWins: 0, otLosses: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, points: 0, last5: [] },
                { id: 15, name: "Лавинные Пантеры", logo: null, games: 0, wins: 0, otWins: 0, otLosses: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, points: 0, last5: [] },
                { id: 16, name: "Снежные Фениксы", logo: null, games: 0, wins: 0, otWins: 0, otLosses: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, points: 0, last5: [] }
            ];
            
            leagueData.news = [
                {
                    id: 1,
                    title: "Старт нового сезона ДХЛ!",
                    content: "Сегодня официально стартовал новый сезон Драконьей Хоккейной Лиги. 16 команд готовы сражаться за Кубок Холодного Пути. В этом сезоне нас ждут новые правила, усиленные составы и еще больше экшена на льду. Первые матчи уже показали, что борьба будет серьезной - несколько игр завершились в овертайме, а разница в классе между командах минимальна.",
                    date: new Date().toLocaleDateString('ru-RU'),
                    image: null,
                    views: 0
                },
                {
                    id: 2,
                    title: "Новые правила сезона",
                    content: "В этом сезоне вводятся новые правила: дополнительный овертайм увеличен до 10 минут, а система начисления очков изменена. Теперь за победу в основное время команда получает 3 очка, за победу в овертайме - 2 очка, за поражение в овертайме - 1 очко, а за поражение в основное время - 0 очков. Также введены новые штрафы за грубую игру.",
                    date: new Date().toLocaleDateString('ru-RU'),
                    image: null,
                    views: 0
                },
                {
                    id: 3,
                    title: "Анонс турнира 'Навстречу Холодного Пути'",
                    content: "В этом сезоне впервые будет проведен утешительный турнир для команд, не попавших в плей-офф. Турнир 'Навстречу Холодного Пути' даст шанс командам реабилитироваться и побороться за специальный трофей. Призовой фонд турнира составит 2 миллиона рублей.",
                    date: new Date().toLocaleDateString('ru-RU'),
                    image: null,
                    views: 0
                }
            ];
            
            // Инициализация текстовых блоков
            leagueData.content.customTexts = {
                homeText1: "ДХЛ была основана в 2010 году как альтернатива традиционным хоккейным лигам. С тех пор она стала домом для самых отчаянных и талантливых команд, которые не боятся рисковать и показывают зрелищный хоккей.",
                homeText2: "Наша философия проста: хоккей должен быть быстрым, агрессивным и зрелищным. Мы поощряем творческий подход, индивидуальное мастерство и командный дух. Каждый матч - это битва, каждый сезон - это война за Кубок Холодного Пути."
            };
            
            // Инициализация плей-офф
            leagueData.playoff = {
                stage: "not_started",
                champion: null,
                series: []
            };
            
            saveToLocalStorage();
        }
        
        function updateUI() {
            document.getElementById('leagueTitle').textContent = leagueData.name;
            document.getElementById('leagueDescriptionText').textContent = leagueData.description;
            document.getElementById('homepageContent').textContent = leagueData.homepageText;
            
            updateLeagueLogo();
            updateStandings();
            updateNews();
            updateStats();
            updateTextBlocks();
            updateEditButtonsVisibility();
            updatePlayoffBracket();
            updatePlayoffStats();
            
            // Показываем/скрываем кнопки управления таблицей для админа
            const standingsControls = document.getElementById('standingsControls');
            const standingsActionsHeader = document.getElementById('standingsActionsHeader');
            if (standingsControls && standingsActionsHeader) {
                if (isAdminAuthenticated) {
                    standingsControls.style.display = 'flex';
                    standingsActionsHeader.style.display = 'table-cell';
                } else {
                    standingsControls.style.display = 'none';
                    standingsActionsHeader.style.display = 'none';
                }
            }
        }
        
        function updateEditButtonsVisibility() {
            const editButtons = document.querySelectorAll('.text-card-edit-btn');
            editButtons.forEach(btn => {
                if (isAdminAuthenticated) {
                    btn.style.display = 'inline-flex';
                } else {
                    btn.style.display = 'none';
                }
            });
        }
        
        function updateLeagueLogo() {
            const mainLeagueLogo = document.getElementById('mainLeagueLogo');
            const defaultLogoIcon = document.getElementById('defaultLogoIcon');
            
            if (leagueData.content.leagueLogo) {
                mainLeagueLogo.src = leagueData.content.leagueLogo;
                mainLeagueLogo.style.display = 'block';
                defaultLogoIcon.style.display = 'none';
            } else {
                mainLeagueLogo.style.display = 'none';
                defaultLogoIcon.style.display = 'block';
            }
        }
        
        function updateStandings() {
            const standingsBody = document.getElementById('standingsBody');
            const topTeams = document.getElementById('topTeams');
            
            if (!standingsBody) return;
            
            const sortedTeams = [...leagueData.teams].sort((a, b) => {
                if (b.points !== a.points) return b.points - a.points;
                if (b.wins !== a.wins) return b.wins - a.wins;
                return (b.goalsFor - b.goalsAgainst) - (a.goalsFor - a.goalsAgainst);
            });
            
            standingsBody.innerHTML = '';
            
            sortedTeams.forEach((team, index) => {
                const row = document.createElement('tr');
                
                if (index < 8) {
                    row.classList.add('playoff-qualified');
                }
                
                let last5Html = '';
                if (team.last5 && team.last5.length > 0) {
                    team.last5.forEach(result => {
                        let className = 'game-result ';
                        if (result === 'W') className += 'win';
                        else if (result === 'L') className += 'loss';
                        else if (result === 'OTL') className += 'ot-loss';
                        
                        last5Html += `<div class="${className}">${result === 'OTL' ? 'ОТ' : result}</div>`;
                    });
                }
                
                while (last5Html.split('game-result').length - 1 < 5) {
                    last5Html += '<div class="game-result" style="opacity: 0.3;">-</div>';
                }
                
                // Добавляем кнопки действий для админа
                let actionsHtml = '';
                if (isAdminAuthenticated) {
                    actionsHtml = `
                        <td>
                            <button class="team-stats-reset-btn" onclick="resetTeamStats(${team.id})" style="padding: 4px 8px; font-size: 0.8rem;">
                                <i class="fas fa-undo"></i> Сбросить
                            </button>
                        </td>
                    `;
                }
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>
                        <div class="team-cell">
                            ${team.logo ? 
                                `<img src="${team.logo}" class="team-logo" alt="${team.name}" onclick="showImageModal('${team.logo}')" style="cursor: pointer;">` : 
                                `<div class="team-logo">${team.name.charAt(0)}</div>`
                            }
                            <span class="team-name">${team.name}</span>
                        </div>
                    </td>
                    <td>${team.games}</td>
                    <td>${team.wins}</td>
                    <td>${team.otWins}</td>
                    <td>${team.otLosses}</td>
                    <td>${team.losses}</td>
                    <td>${team.goalsFor - team.goalsAgainst}</td>
                    <td><strong>${team.points}</strong></td>
                    <td>
                        <div class="last-games">
                            ${last5Html}
                        </div>
                    </td>
                    ${actionsHtml}
                `;
                
                standingsBody.appendChild(row);
            });
            
            if (topTeams) {
                topTeams.innerHTML = '';
                
                const top5 = sortedTeams.slice(0, 5);
                top5.forEach((team, index) => {
                    const teamDiv = document.createElement('div');
                    teamDiv.style.display = 'flex';
                    teamDiv.style.alignItems = 'center';
                    teamDiv.style.marginBottom = '15px';
                    teamDiv.style.padding = '10px';
                    teamDiv.style.backgroundColor = 'var(--metal-light)';
                    teamDiv.style.borderRadius = '8px';
                    
                    teamDiv.innerHTML = `
                        <div style="font-size: 1.5rem; font-weight: bold; margin-right: 15px; color: var(--accent-red);">${index + 1}</div>
                        ${team.logo ? 
                            `<img src="${team.logo}" style="width: 40px; height: 40px; border-radius: 50%; margin-right: 15px; border: 2px solid var(--metal-border);">` : 
                            `<div style="width: 40px; height: 40px; border-radius: 50%; margin-right: 15px; background: var(--metal-border); display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--accent-red);">${team.name.charAt(0)}</div>`
                        }
                        <div style="flex: 1;">
                            <div style="font-weight: bold;">${team.name}</div>
                            <div style="font-size: 0.9rem; color: var(--text-gray);">Очки: ${team.points} | Игры: ${team.games}</div>
                        </div>
                    `;
                    
                    topTeams.appendChild(teamDiv);
                });
            }
        }
        
        function updateNews() {
            const latestNews = document.getElementById('latestNews');
            const allNews = document.getElementById('allNews');
            
            if (latestNews) {
                latestNews.innerHTML = '';
                
                const latest = leagueData.news.slice(0, 3);
                latest.forEach(news => {
                    const newsCard = createNewsCard(news);
                    latestNews.appendChild(newsCard);
                });
            }
            
            if (allNews) {
                allNews.innerHTML = '';
                
                leagueData.news.forEach(news => {
                    const newsCard = createNewsCard(news);
                    allNews.appendChild(newsCard);
                });
            }
        }
        
        function createNewsCard(news) {
            const card = document.createElement('div');
            card.className = 'news-card';
            
            const previewText = news.content.length > 150 ? 
                news.content.substring(0, 150) + '...' : 
                news.content;
            
            card.innerHTML = `
                ${news.image ? 
                    `<img src="${news.image}" class="news-image" alt="${news.title}" onclick="showImageModal('${news.image}')" style="cursor: pointer;">` : 
                    `<div class="news-image" style="background: var(--metal-dark); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-newspaper" style="font-size: 3rem; color: var(--metal-border);"></i>
                    </div>`
                }
                <div class="news-content">
                    <span class="news-date">${news.date}</span>
                    <h3 class="news-title">${news.title}</h3>
                    <p class="news-text">${previewText}</p>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <button class="read-more-btn" onclick="openNewsModal(${news.id})">
                            <i class="fas fa-book-open"></i> Читать полностью
                        </button>
                        <div class="news-views">
                            <i class="fas fa-eye"></i>
                            <span>${getNewsViews(news.id)}</span>
                        </div>
                    </div>
                </div>
            `;
            
            return card;
        }
        
        function updateStats() {
            // Подсчитываем реальную статистику
            let totalGoals = 0;
            let totalMatchesPlayed = 0;
            let overtimeMatches = 0;
            
            leagueData.matches.forEach(match => {
                if (match.completed) {
                    totalGoals += (match.homeScore || 0) + (match.awayScore || 0);
                    totalMatchesPlayed++;
                    if (match.overtime) overtimeMatches++;
                }
            });
            
            const avgGoals = totalMatchesPlayed > 0 ? (totalGoals / totalMatchesPlayed).toFixed(1) : "0.0";
            
            document.getElementById('totalGoals').textContent = totalGoals;
            document.getElementById('avgGoals').textContent = avgGoals;
            document.getElementById('totalMatchesPlayed').textContent = totalMatchesPlayed;
            document.getElementById('overtimeMatches').textContent = overtimeMatches;
        }
        
        function updateTextBlocks() {
            if (leagueData.content.customTexts) {
                for (const blockId in leagueData.content.customTexts) {
                    const contentDiv = document.getElementById(blockId + 'Content');
                    if (contentDiv) {
                        contentDiv.innerHTML = leagueData.content.customTexts[blockId];
                    }
                }
            }
        }
        
        function loadNewsViews() {
            const savedViews = localStorage.getItem('dhl_news_views');
            if (savedViews) {
                newsViews = JSON.parse(savedViews);
            }
        }
        
        function saveNewsViews() {
            localStorage.setItem('dhl_news_views', JSON.stringify(newsViews));
        }
        
        function incrementNewsViews(newsId) {
            if (!newsViews[newsId]) {
                newsViews[newsId] = 0;
            }
            newsViews[newsId]++;
            saveNewsViews();
            
            const newsItem = leagueData.news.find(n => n.id === newsId);
            if (newsItem) {
                newsItem.views = (newsItem.views || 0) + 1;
                saveToLocalStorage();
            }
            
            return newsViews[newsId];
        }
        
        function getNewsViews(newsId) {
            return newsViews[newsId] || 0;
        }
        
        function openNewsModal(newsId) {
            const newsItem = leagueData.news.find(n => n.id === newsId);
            if (!newsItem) return;
            
            const views = incrementNewsViews(newsId);
            
            document.getElementById('newsModalTitle').textContent = newsItem.title;
            document.getElementById('newsModalDate').textContent = newsItem.date;
            document.getElementById('newsModalContent').innerHTML = newsItem.content;
            document.getElementById('newsModalViews').textContent = views;
            
            const imageElement = document.getElementById('newsModalImage');
            if (newsItem.image) {
                imageElement.src = newsItem.image;
                imageElement.style.display = 'block';
            } else {
                imageElement.style.display = 'none';
            }
            
            document.getElementById('newsModal').style.display = 'flex';
        }
        
        function closeNewsModal() {
            document.getElementById('newsModal').style.display = 'none';
        }
        
        // ==================== УПРАВЛЕНИЕ НОВОСТЯМИ ====================
        
        function editNews(newsId) {
            const news = leagueData.news.find(n => n.id === newsId);
            if (!news) return;
            
            editingNewsId = newsId;
            
            document.getElementById('editNewsTitle').value = news.title;
            document.getElementById('editNewsContent').value = news.content;
            
            const preview = document.getElementById('editNewsImagePreview');
            if (news.image) {
                preview.src = news.image;
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
            
            editNewsImageDataURL = null;
            document.getElementById('editNewsImageUpload').value = '';
            
            document.getElementById('editNewsModal').style.display = 'flex';
        }
        
        async function saveNewsEdit() {
            if (!editingNewsId) return;
            
            const news = leagueData.news.find(n => n.id === editingNewsId);
            if (!news) return;
            
            const title = document.getElementById('editNewsTitle').value.trim();
            const content = document.getElementById('editNewsContent').value.trim();
            
            if (!title || !content) {
                showNotification('Заполните заголовок и текст новости!', 'error');
                return;
            }
            
            try {
                showLoader('globalLoader', true);
                
                news.title = title;
                news.content = content;
                news.date = new Date().toLocaleDateString('ru-RU');
                
                if (editNewsImageDataURL) {
                    const file = dataURLtoFile(editNewsImageDataURL, `news_${title.replace(/\s+/g, '_')}.jpg`);
                    news.image = await uploadImageToImgBB(file, 'news');
                }
                
                updateUI();
                updateNewsList();
                saveToLocalStorage();
                
                if (isFirebaseConnected) {
                    await saveDataToFirebase();
                }
                
                closeEditNewsModal();
                showNotification('Новость обновлена!', 'success');
                
            } catch (error) {
                console.error('Ошибка сохранения новости:', error);
                showNotification('Ошибка: ' + error.message, 'error');
            } finally {
                showLoader('globalLoader', false);
            }
        }
        
        function closeEditNewsModal() {
            editingNewsId = null;
            editNewsImageDataURL = null;
            document.getElementById('editNewsModal').style.display = 'none';
        }
        
        function updateNewsList() {
            const adminNewsList = document.getElementById('adminNewsList');
            const newsCount = document.getElementById('newsCount');
            
            if (adminNewsList) {
                adminNewsList.innerHTML = '';
                newsCount.textContent = leagueData.news.length;
                
                leagueData.news.forEach(news => {
                    const newsItem = document.createElement('div');
                    newsItem.className = 'team-list-item';
                    
                    newsItem.innerHTML = `
                        <div class="team-list-info">
                            <div>
                                <div class="team-list-name">${news.title}</div>
                                <div class="team-list-stats">
                                    ${news.date} | Просмотров: ${getNewsViews(news.id)} | ${news.image ? 'Есть изображение' : 'Без изображения'}
                                </div>
                            </div>
                        </div>
                        <div class="team-actions">
                            <div class="action-btn edit" onclick="editNews(${news.id})" title="Редактировать">
                                <i class="fas fa-edit"></i>
                            </div>
                            <div class="action-btn delete" onclick="deleteNews(${news.id})" title="Удалить">
                                <i class="fas fa-trash"></i>
                            </div>
                        </div>
                    `;
                    
                    adminNewsList.appendChild(newsItem);
                });
            }
        }
        
        function deleteNews(newsId) {
            if (!confirm('Вы уверены, что хотите удалить эту новость?')) {
                return;
            }
            
            leagueData.news = leagueData.news.filter(n => n.id !== newsId);
            updateUI();
            updateNewsList();
            saveToLocalStorage();
            
            if (isFirebaseConnected) {
                saveDataToFirebase();
            }
            
            showNotification('Новость удалена!', 'success');
        }
        
        // ==================== РЕДАКТИРОВАНИЕ КОМАНД ====================
        
        function editTeam(teamId) {
            const team = leagueData.teams.find(t => t.id === teamId);
            if (!team) {
                showNotification('Команда не найдена!', 'error');
                return;
            }
            
            editingTeamId = teamId;
            
            document.getElementById('editTeamName').value = team.name;
            document.getElementById('editTeamGames').textContent = team.games;
            document.getElementById('editTeamWins').textContent = team.wins;
            document.getElementById('editTeamOTWins').textContent = team.otWins;
            document.getElementById('editTeamOTLosses').textContent = team.otLosses;
            document.getElementById('editTeamLosses').textContent = team.losses;
            document.getElementById('editTeamPoints').textContent = team.points;
            document.getElementById('editTeamGoalsFor').textContent = team.goalsFor;
            document.getElementById('editTeamGoalsAgainst').textContent = team.goalsAgainst;
            
            const preview = document.getElementById('editTeamLogoPreview');
            if (team.logo) {
                preview.src = team.logo;
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
            
            editTeamLogoDataURL = null;
            document.getElementById('editTeamLogoUpload').value = '';
            
            document.getElementById('editTeamModal').style.display = 'flex';
        }
        
        async function saveTeamEdit() {
            if (!editingTeamId) return;
            
            const team = leagueData.teams.find(t => t.id === editingTeamId);
            if (!team) return;
            
            const newName = document.getElementById('editTeamName').value.trim();
            if (!newName) {
                showNotification('Введите название команды!', 'error');
                return;
            }
            
            try {
                showLoader('globalLoader', true);
                
                team.name = newName;
                
                if (editTeamLogoDataURL) {
                    const file = dataURLtoFile(editTeamLogoDataURL, `logo_${newName.replace(/\s+/g, '_')}.jpg`);
                    team.logo = await uploadImageToImgBB(file, 'teams');
                }
                
                updateUI();
                updateTeamsList();
                saveToLocalStorage();
                
                if (isFirebaseConnected) {
                    await saveDataToFirebase();
                }
                
                closeEditTeamModal();
                showNotification('Команда обновлена!', 'success');
                
            } catch (error) {
                console.error('Ошибка сохранения команды:', error);
                showNotification('Ошибка: ' + error.message, 'error');
            } finally {
                showLoader('globalLoader', false);
            }
        }
        
        function closeEditTeamModal() {
            editingTeamId = null;
            editTeamLogoDataURL = null;
            document.getElementById('editTeamModal').style.display = 'none';
        }
        
        function deleteTeam(teamId) {
            if (!confirm('Вы уверены, что хотите удалить эту команду?')) {
                return;
            }
            
            // Удаляем команду из всех матчей
            leagueData.matches = leagueData.matches.filter(match => 
                match.homeTeamId !== teamId && match.awayTeamId !== teamId
            );
            
            // Удаляем команду из списка
            leagueData.teams = leagueData.teams.filter(t => t.id !== teamId);
            
            // Пересчитываем статистику для всех команд
            recalculateAllTeamStats();
            
            updateUI();
            updateTeamsList();
            updateEditableMatchesList();
            saveToLocalStorage();
            
            if (isFirebaseConnected) {
                saveDataToFirebase();
            }
            
            showNotification('Команда удалена!', 'success');
        }
        
        function updateTeamsList() {
            const teamsList = document.getElementById('teamsList');
            const teamsCount = document.getElementById('teamsCount');
            
            if (!teamsList) return;
            
            teamsList.innerHTML = '';
            teamsCount.textContent = leagueData.teams.length;
            
            leagueData.teams.forEach(team => {
                const teamItem = document.createElement('div');
                teamItem.className = 'team-list-item';
                
                teamItem.innerHTML = `
                    <div class="team-list-info">
                        ${team.logo ? 
                            `<img src="${team.logo}" class="team-list-logo" alt="${team.name}" onclick="showImageModal('${team.logo}')" style="cursor: pointer;">` : 
                            `<div class="team-list-logo">${team.name.charAt(0)}</div>`
                        }
                        <div>
                            <div class="team-list-name">${team.name}</div>
                            <div class="team-list-stats">
                                И: ${team.games} | В: ${team.wins} | ВО: ${team.otWins} | ПО: ${team.otLosses} | П: ${team.losses} | О: ${team.points}
                            </div>
                        </div>
                    </div>
                    <div class="team-actions">
                        <div class="action-btn edit" onclick="editTeam(${team.id})" title="Редактировать">
                            <i class="fas fa-edit"></i>
                        </div>
                        <div class="action-btn delete" onclick="deleteTeam(${team.id})" title="Удалить">
                            <i class="fas fa-trash"></i>
                        </div>
                        <div class="action-btn" onclick="resetTeamStats(${team.id})" title="Сбросить статистику" style="color: #ff9900; border-color: #ff9900;">
                            <i class="fas fa-undo"></i>
                        </div>
                    </div>
                `;
                
                teamsList.appendChild(teamItem);
            });
        }
        
        // ==================== ДОБАВЛЕНИЕ КОМАНД ====================
        
        async function addTeam() {
            const teamName = document.getElementById('newTeamName').value.trim();
            if (!teamName) {
                showNotification('Введите название команды!', 'error');
                return;
            }
            
            try {
                showLoader('globalLoader', true);
                
                let logoUrl = null;
                
                if (uploadedTeamLogoDataURL && leagueData.settings.imgbbApiKey) {
                    const file = dataURLtoFile(uploadedTeamLogoDataURL, `logo_${teamName.replace(/\s+/g, '_')}.jpg`);
                    logoUrl = await uploadImageToImgBB(file, 'teams');
                } else if (uploadedTeamLogoDataURL) {
                    logoUrl = uploadedTeamLogoDataURL;
                }
                
                const newTeam = {
                    id: leagueData.teams.length > 0 ? Math.max(...leagueData.teams.map(t => t.id)) + 1 : 1,
                    name: teamName,
                    logo: logoUrl,
                    games: 0,
                    wins: 0,
                    otWins: 0,
                    otLosses: 0,
                    losses: 0,
                    goalsFor: 0,
                    goalsAgainst: 0,
                    points: 0,
                    last5: []
                };
                
                leagueData.teams.push(newTeam);
                updateUI();
                updateTeamsList();
                saveToLocalStorage();
                
                if (isFirebaseConnected) {
                    await saveDataToFirebase();
                }
                
                document.getElementById('newTeamName').value = '';
                clearTeamLogoPreview();
                
                showNotification(`Команда "${teamName}" добавлена!`, 'success');
                
            } catch (error) {
                console.error('Ошибка добавления команды:', error);
                showNotification('Ошибка: ' + error.message, 'error');
            } finally {
                showLoader('globalLoader', false);
            }
        }
        
        // ==================== ДОБАВЛЕНИЕ НОВОСТЕЙ ====================
        
        async function addNews() {
            const title = document.getElementById('newsTitle').value.trim();
            const content = document.getElementById('newsContent').value.trim();
            
            if (!title || !content) {
                showNotification('Заполните заголовок и текст новости!', 'error');
                return;
            }
            
            try {
                showLoader('globalLoader', true);
                
                let imageUrl = null;
                
                if (uploadedNewsImageDataURL && leagueData.settings.imgbbApiKey) {
                    const file = dataURLtoFile(uploadedNewsImageDataURL, `news_${title.substring(0, 20).replace(/\s+/g, '_')}.jpg`);
                    imageUrl = await uploadImageToImgBB(file, 'news');
                } else if (uploadedNewsImageDataURL) {
                    imageUrl = uploadedNewsImageDataURL;
                }
                
                const newNews = {
                    id: leagueData.news.length > 0 ? Math.max(...leagueData.news.map(n => n.id)) + 1 : 1,
                    title: title,
                    content: content,
                    date: new Date().toLocaleDateString('ru-RU'),
                    image: imageUrl,
                    views: 0
                };
                
                leagueData.news.unshift(newNews);
                updateUI();
                updateNewsList();
                saveToLocalStorage();
                
                if (isFirebaseConnected) {
                    await saveDataToFirebase();
                }
                
                document.getElementById('newsTitle').value = '';
                document.getElementById('newsContent').value = '';
                clearNewsImagePreview();
                
                showNotification('Новость добавлена!', 'success');
                
            } catch (error) {
                console.error('Ошибка добавления новости:', error);
                showNotification('Ошибка: ' + error.message, 'error');
            } finally {
                showLoader('globalLoader', false);
            }
        }
        
        // ==================== УПРАВЛЕНИЕ КОНТЕНТОМ ====================
        
        function saveContentChanges() {
            leagueData.name = document.getElementById('leagueName').value;
            leagueData.description = document.getElementById('leagueDescription').value;
            leagueData.homepageText = document.getElementById('homepageText').value;
            
            if (uploadedLeagueLogoDataURL) {
                leagueData.content.leagueLogo = uploadedLeagueLogoDataURL;
            }
            
            updateUI();
            saveToLocalStorage();
            
            if (isFirebaseConnected) {
                saveDataToFirebase();
            }
            
            showNotification('Изменения контента сохранены!', 'success');
        }
        
        function editTextBlock(blockId) {
            if (!isAdminAuthenticated) {
                showNotification('Требуется авторизация администратора!', 'error');
                return;
            }
            
            editingTextBlockId = blockId;
            
            document.getElementById(blockId + 'Content').style.display = 'none';
            const editor = document.getElementById(blockId + 'Editor');
            editor.style.display = 'block';
            
            const textarea = document.getElementById(blockId + 'Textarea');
            let currentText = '';
            
            if (leagueData.content.customTexts && leagueData.content.customTexts[blockId]) {
                currentText = leagueData.content.customTexts[blockId];
            } else {
                const contentDiv = document.getElementById(blockId + 'Content');
                currentText = contentDiv.innerHTML;
            }
            
            textarea.value = currentText.replace(/<br\s*\/?>/gi, '\n');
            textarea.focus();
        }
        
        function saveTextBlock(blockId) {
            if (!isAdminAuthenticated) {
                showNotification('Требуется авторизация администратора!', 'error');
                return;
            }
            
            const textarea = document.getElementById(blockId + 'Textarea');
            let newText = textarea.value.trim();
            
            if (!newText) {
                showNotification('Текст не может быть пустым!', 'error');
                return;
            }
            
            newText = newText.replace(/\n/g, '<br>');
            
            if (!leagueData.content.customTexts) {
                leagueData.content.customTexts = {};
            }
            leagueData.content.customTexts[blockId] = newText;
            
            saveToLocalStorage();
            
            if (isFirebaseConnected) {
                saveDataToFirebase();
            }
            
            const contentDiv = document.getElementById(blockId + 'Content');
            contentDiv.innerHTML = newText;
            
            cancelEditText(blockId);
            
            showNotification('Текст сохранен и будет виден всем пользователям!', 'success');
        }
        
        function cancelEditText(blockId) {
            editingTextBlockId = null;
            
            document.getElementById(blockId + 'Editor').style.display = 'none';
            document.getElementById(blockId + 'Content').style.display = 'block';
        }
        
        // ==================== СИСТЕМА БЕЗОПАСНОСТИ ====================
        
        function accessAdminFromLogo() {
            document.getElementById('passwordModal').style.display = 'flex';
        }
        
        function closePasswordModal() {
            document.getElementById('passwordModal').style.display = 'none';
            document.getElementById('adminPasswordInput').value = '';
            document.getElementById('passwordError').style.display = 'none';
        }
        
        function checkAdminPassword() {
            const input = document.getElementById('adminPasswordInput').value;
            const errorElement = document.getElementById('passwordError');
            
            if (input === leagueData.settings.adminPassword) {
                isAdminAuthenticated = true;
                document.getElementById('passwordModal').style.display = 'none';
                document.getElementById('adminPanel').classList.add('active');
                updateEditButtonsVisibility();
                showNotification('Доступ к админ-панели разрешен!', 'success');
            } else {
                errorElement.style.display = 'block';
                document.getElementById('adminPasswordInput').value = '';
                setTimeout(() => errorElement.style.display = 'none', 3000);
            }
        }
        
        function exitAdminPanel() {
            document.getElementById('adminPanel').classList.remove('active');
            showNotification('Админ-панель закрыта. Вы остаетесь администратором.', 'info');
        }
        
        function logoutAdmin() {
            isAdminAuthenticated = false;
            document.getElementById('adminPanel').classList.remove('active');
            updateEditButtonsVisibility();
            showNotification('Вы вышли из админ-панели.', 'info');
        }
        
        function switchAdminTab(tabId) {
            const tabs = document.querySelectorAll('.admin-tab');
            const sections = document.querySelectorAll('.admin-section');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            sections.forEach(section => section.style.display = 'none');
            
            document.querySelector(`.admin-tab[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId + 'Tab').style.display = 'block';
            
            if (tabId === 'matches') {
                updateEditableMatchesList();
                updateMatchesStats();
            } else if (tabId === 'playoff') {
                updatePlayoffAdminUI();
            } else if (tabId === 'teams') {
                updateTeamsList();
            } else if (tabId === 'news') {
                updateNewsList();
            }
        }
        
        function toggleAdminPanelPosition() {
            const panel = document.getElementById('adminPanel');
            panel.classList.toggle('left-side');
        }
        
        function changeAdminPassword() {
            const newPass = document.getElementById('newPassword').value;
            const confirmPass = document.getElementById('confirmPassword').value;
            
            if (!newPass || !confirmPass) {
                showNotification('Заполните все поля!', 'error');
                return;
            }
            
            if (newPass !== confirmPass) {
                showNotification('Пароли не совпадают!', 'error');
                return;
            }
            
            leagueData.settings.adminPassword = newPass;
            saveToLocalStorage();
            
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            showNotification('Пароль изменен!', 'success');
        }
        
        // ==================== УПРАВЛЕНИЕ МАТЧАМИ ====================
        
        function generateRandomCalendar() {
            if (leagueData.teams.length < 2) {
                showNotification('Нужно хотя бы 2 команды для создания календаря!', 'error');
                return;
            }
            
            leagueData.matches = [];
            let matchId = 1;
            
            // Создаем матчи для 22 игр на команду
            const allMatches = [];
            
            // Каждая команда играет с каждой по одному разу дома и один раз в гостях
            for (let round = 1; round <= 11; round++) {
                const teamsCopy = [...leagueData.teams];
                shuffleArray(teamsCopy);
                
                // Разбиваем на пары
                for (let i = 0; i < teamsCopy.length; i += 2) {
                    if (i + 1 < teamsCopy.length) {
                        // Домашний матч
                        allMatches.push({
                            id: matchId++,
                            homeTeamId: teamsCopy[i].id,
                            awayTeamId: teamsCopy[i + 1].id,
                            homeScore: 0,
                            awayScore: 0,
                            completed: false,
                            overtime: false,
                            date: '',
                            round: round,
                            timestamp: Date.now() + (round - 1) * 86400000 * 2
                        });
                        
                        // Гостевой матч (в следующем раунде)
                        allMatches.push({
                            id: matchId++,
                            homeTeamId: teamsCopy[i + 1].id,
                            awayTeamId: teamsCopy[i].id,
                            homeScore: 0,
                            awayScore: 0,
                            completed: false,
                            overtime: false,
                            date: '',
                            round: round + 11,
                            timestamp: Date.now() + (round + 10) * 86400000 * 2
                        });
                    }
                }
            }
            
            // Распределяем по датам
            const startDate = new Date();
            for (let i = 0; i < allMatches.length; i++) {
                const matchDate = new Date(startDate);
                matchDate.setDate(startDate.getDate() + Math.floor(i / 4));
                allMatches[i].date = matchDate.toLocaleDateString('ru-RU');
                allMatches[i].timestamp = matchDate.getTime();
            }
            
            // Сортируем по раундам и датам
            allMatches.sort((a, b) => {
                if (a.round !== b.round) return a.round - b.round;
                return a.timestamp - b.timestamp;
            });
            
            leagueData.matches = allMatches;
            
            // Сохраняем в Firebase
            saveToLocalStorage();
            if (isFirebaseConnected) {
                saveDataToFirebase();
            }
            
            // Обновляем весь интерфейс
            forceRefreshAll();
            
            showNotification(`Случайный календарь создан! Всего матчей: ${leagueData.matches.length}`, 'success');
        }
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        function updateEditableMatchesList() {
            const adminMatchesList = document.getElementById('adminMatchesList');
            if (!adminMatchesList) return;
            
            adminMatchesList.innerHTML = '';
            
            // Сортируем матчи по дате
            const sortedMatches = [...leagueData.matches].sort((a, b) => {
                if (a.timestamp && b.timestamp) {
                    return a.timestamp - b.timestamp;
                }
                return a.id - b.id;
            });
            
            sortedMatches.forEach(match => {
                const homeTeam = leagueData.teams.find(t => t.id === match.homeTeamId);
                const awayTeam = leagueData.teams.find(t => t.id === match.awayTeamId);
                
                if (!homeTeam || !awayTeam) return;
                
                const matchCard = document.createElement('div');
                matchCard.className = 'admin-match-card';
                
                matchCard.innerHTML = `
                    <div class="admin-match-header">
                        <div style="font-weight: bold; color: var(--accent-blue);">Тур ${match.round || 1}</div>
                        <div style="color: var(--text-gray); font-size: 0.9rem;">${match.date}</div>
                    </div>
                    <div class="match-body">
                        <div class="match-team match-team-home">
                            <div class="match-team-name">${homeTeam.name}</div>
                            ${homeTeam.logo ? `<img src="${homeTeam.logo}" class="match-team-logo" style="width: 30px; height: 30px;">` : '<div class="match-team-logo" style="width: 30px; height: 30px;">' + homeTeam.name.charAt(0) + '</div>'}
                            <input type="number" class="score-input" id="homeScore_${match.id}" value="${match.homeScore}" ${match.completed ? '' : 'disabled'}>
                        </div>
                        <div class="match-score">${match.completed ? `${match.homeScore}:${match.awayScore}` : 'vs'}</div>
                        <div class="match-team match-team-away">
                            <input type="number" class="score-input" id="awayScore_${match.id}" value="${match.awayScore}" ${match.completed ? '' : 'disabled'}>
                            ${awayTeam.logo ? `<img src="${awayTeam.logo}" class="match-team-logo" style="width: 30px; height: 30px;">` : '<div class="match-team-logo" style="width: 30px; height: 30px;">' + awayTeam.name.charAt(0) + '</div>'}
                            <div class="match-team-name">${awayTeam.name}</div>
                        </div>
                    </div>
                    <div class="admin-match-controls">
                        <button class="match-action-btn simulate" onclick="simulateSingleMatch(${match.id})">
                            <i class="fas fa-play"></i> Симулировать
                        </button>
                        <button class="match-action-btn" onclick="saveMatchScore(${match.id})" style="background: linear-gradient(145deg, var(--accent-blue-dark), var(--accent-blue)); color: white;">
                            <i class="fas fa-save"></i> Сохранить
                        </button>
                        <button class="match-action-btn reset" onclick="resetMatch(${match.id})">
                            <i class="fas fa-undo"></i> Сбросить
                        </button>
                        <button class="match-action-btn delete" onclick="deleteMatch(${match.id})">
                            <i class="fas fa-trash"></i> Удалить
                        </button>
                        <label style="margin-left: auto; color: var(--text-gray); display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" id="overtime_${match.id}" ${match.overtime ? 'checked' : ''}> Овертайм
                        </label>
                        <label style="color: var(--text-gray); display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" id="completed_${match.id}" ${match.completed ? 'checked' : ''} onchange="toggleMatchEdit(${match.id})"> Завершен
                        </label>
                    </div>
                `;
                
                adminMatchesList.appendChild(matchCard);
            });
            
            updateMatchesStats();
        }
        
        function toggleMatchEdit(matchId) {
            const match = leagueData.matches.find(m => m.id === matchId);
            if (!match) return;
            
            const completedCheckbox = document.getElementById(`completed_${matchId}`);
            match.completed = completedCheckbox.checked;
            
            const homeScoreInput = document.getElementById(`homeScore_${matchId}`);
            const awayScoreInput = document.getElementById(`awayScore_${matchId}`);
            
            if (match.completed) {
                homeScoreInput.disabled = false;
                awayScoreInput.disabled = false;
            } else {
                homeScoreInput.disabled = true;
                awayScoreInput.disabled = true;
                
                // Сбрасываем счет если матч не завершен
                if (match.homeScore > 0 || match.awayScore > 0) {
                    match.homeScore = 0;
                    match.awayScore = 0;
                    match.overtime = false;
                    homeScoreInput.value = 0;
                    awayScoreInput.value = 0;
                    document.getElementById(`overtime_${matchId}`).checked = false;
                    
                    // Обновляем статистику команд
                    updateTeamStats(match);
                }
            }
            
            saveToLocalStorage();
            if (isFirebaseConnected) saveDataToFirebase();
        }
        
        function deleteMatch(matchId) {
            if (!confirm('Вы уверены, что хотите удалить этот матч?')) {
                return;
            }
            
            const match = leagueData.matches.find(m => m.id === matchId);
            if (match && match.completed) {
                // Сначала сбрасываем счет для обновления статистики
                match.homeScore = 0;
                match.awayScore = 0;
                match.overtime = false;
                match.completed = false;
                updateTeamStats(match);
            }
            
            leagueData.matches = leagueData.matches.filter(m => m.id !== matchId);
            
            // Обновляем весь интерфейс
            forceRefreshAll();
            
            showNotification('Матч удален!', 'success');
        }
        
        function recalculateAllTeamStats() {
            // Сбрасываем статистику всех команд
            leagueData.teams.forEach(team => {
                team.games = 0;
                team.wins = 0;
                team.otWins = 0;
                team.otLosses = 0;
                team.losses = 0;
                team.goalsFor = 0;
                team.goalsAgainst = 0;
                team.points = 0;
                team.last5 = [];
            });
            
            // Пересчитываем статистику на основе завершенных матчей
            leagueData.matches.forEach(match => {
                if (match.completed) {
                    updateTeamStats(match);
                }
            });
        }
        
        function updateMatchesStats() {
            let scheduled = 0;
            let played = 0;
            let totalGoals = 0;
            let overtime = 0;
            
            leagueData.matches.forEach(match => {
                if (match.completed) {
                    played++;
                    totalGoals += match.homeScore + match.awayScore;
                    if (match.overtime) overtime++;
                } else {
                    scheduled++;
                }
            });
            
            document.getElementById('scheduledMatchesCount').textContent = scheduled;
            document.getElementById('playedMatchesCount').textContent = played;
            document.getElementById('totalGoalsCount').textContent = totalGoals;
            document.getElementById('overtimeMatchesCount').textContent = overtime;
        }
        
        function editMatchScoreInCalendar(matchId) {
            if (!isAdminAuthenticated) {
                showNotification('Требуется авторизация администратора!', 'error');
                return;
            }
            
            const match = leagueData.matches.find(m => m.id === matchId);
            if (!match) return;
            
            editingMatchId = matchId;
            
            const homeTeam = leagueData.teams.find(t => t.id === match.homeTeamId);
            const awayTeam = leagueData.teams.find(t => t.id === match.awayTeamId);
            
            // Заполняем форму
            document.getElementById('editMatchHomeTeamName').textContent = homeTeam?.name || 'Хозяева';
            document.getElementById('editMatchAwayTeamName').textContent = awayTeam?.name || 'Гости';
            
            if (homeTeam?.logo) {
                document.getElementById('editMatchHomeTeamLogo').src = homeTeam.logo;
                document.getElementById('editMatchHomeTeamLogo').style.display = 'block';
            } else {
                document.getElementById('editMatchHomeTeamLogo').style.display = 'none';
            }
            
            if (awayTeam?.logo) {
                document.getElementById('editMatchAwayTeamLogo').src = awayTeam.logo;
                document.getElementById('editMatchAwayTeamLogo').style.display = 'block';
            } else {
                document.getElementById('editMatchAwayTeamLogo').style.display = 'none';
            }
            
            document.getElementById('editMatchHomeScore').value = match.homeScore;
            document.getElementById('editMatchAwayScore').value = match.awayScore;
            document.getElementById('editMatchOvertime').checked = match.overtime;
            document.getElementById('editMatchCompleted').checked = match.completed;
            document.getElementById('editMatchDate').textContent = match.date;
            document.getElementById('editMatchRound').textContent = `Тур ${match.round || 1}`;
            
            // Показываем модальное окно
            document.getElementById('editMatchModal').style.display = 'flex';
        }
        
        function closeEditMatchModal() {
            editingMatchId = null;
            document.getElementById('editMatchModal').style.display = 'none';
        }
        
        function simulateCalendarMatch() {
            if (!editingMatchId) return;
            
            const match = leagueData.matches.find(m => m.id === editingMatchId);
            if (!match) return;
            
            // Генерируем случайный счет
            let homeScore = Math.floor(Math.random() * 5);
            let awayScore = Math.floor(Math.random() * 5);
            
            // 30% шанс на овертайм
            const isOvertime = Math.random() < 0.3;
            
            if (isOvertime && homeScore === awayScore) {
                // В овертайме добавляем один гол
                if (Math.random() > 0.5) {
                    homeScore += 1;
                } else {
                    awayScore += 1;
                }
            } else if (homeScore === awayScore) {
                // Если ничья в основное время, делаем разницу в 1 гол
                if (Math.random() > 0.5) {
                    homeScore += 1;
                } else {
                    awayScore += 1;
                }
            }
            
            // Обновляем поля ввода
            document.getElementById('editMatchHomeScore').value = homeScore;
            document.getElementById('editMatchAwayScore').value = awayScore;
            document.getElementById('editMatchOvertime').checked = isOvertime && homeScore !== awayScore;
            document.getElementById('editMatchCompleted').checked = true;
            
            showNotification(`Счет сгенерирован: ${homeScore}:${awayScore}${isOvertime && homeScore !== awayScore ? ' (ОТ)' : ''}`, 'success');
        }
        
        // ==================== ПЛЕЙ-ОФФ СИСТЕМА ====================
        
        function generatePlayoffBracket() {
            // Получаем топ-8 команд из таблицы
            const sortedTeams = [...leagueData.teams].sort((a, b) => {
                if (b.points !== a.points) return b.points - a.points;
                if (b.wins !== a.wins) return b.wins - a.wins;
                return (b.goalsFor - b.goalsAgainst) - (a.goalsFor - a.goalsAgainst);
            });
            
            const top8Teams = sortedTeams.slice(0, 8);
            
            if (top8Teams.length < 8) {
                showNotification('Недостаточно команд для плей-офф! Нужно хотя бы 8 команд в таблице.', 'error');
                return;
            }
            
            // Очищаем старые серии
            leagueData.playoff.series = [];
            
            // Создаем серии для первого раунда (1/4 финала)
            const quarterfinalSeries = [
                { 
                    id: 1,
                    round: 1,
                    team1Id: top8Teams[0].id, 
                    team2Id: top8Teams[7].id,
                    team1Wins: 0,
                    team2Wins: 0,
                    winnerId: null,
                    games: [
                        { id: 1, homeTeamId: top8Teams[0].id, awayTeamId: top8Teams[7].id, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 1", timestamp: Date.now() },
                        { id: 2, homeTeamId: top8Teams[7].id, awayTeamId: top8Teams[0].id, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 2", timestamp: Date.now() + 86400000 },
                        { id: 3, homeTeamId: top8Teams[0].id, awayTeamId: top8Teams[7].id, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 3", timestamp: Date.now() + 172800000 },
                        { id: 4, homeTeamId: top8Teams[7].id, awayTeamId: top8Teams[0].id, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 4", timestamp: Date.now() + 259200000 },
                        { id: 5, homeTeamId: top8Teams[0].id, awayTeamId: top8Teams[7].id, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 5", timestamp: Date.now() + 345600000 }
                    ]
                },
                { 
                    id: 2,
                    round: 1,
                    team1Id: top8Teams[1].id, 
                    team2Id: top8Teams[6].id,
                    team1Wins: 0,
                    team2Wins: 0,
                    winnerId: null,
                    games: [
                        { id: 1, homeTeamId: top8Teams[1].id, awayTeamId: top8Teams[6].id, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 1", timestamp: Date.now() },
                        { id: 2, homeTeamId: top8Teams[6].id, awayTeamId: top8Teams[1].id, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 2", timestamp: Date.now() + 86400000 },
                        { id: 3, homeTeamId: top8Teams[1].id, awayTeamId: top8Teams[6].id, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 3", timestamp: Date.now() + 172800000 },
                        { id: 4, homeTeamId: top8Teams[6].id, awayTeamId: top8Teams[1].id, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 4", timestamp: Date.now() + 259200000 },
                        { id: 5, homeTeamId: top8Teams[1].id, awayTeamId: top8Teams[6].id, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 5", timestamp: Date.now() + 345600000 }
                    ]
                },
                { 
                    id: 3,
                    round: 1,
                    team1Id: top8Teams[2].id, 
                    team2Id: top8Teams[5].id,
                    team1Wins: 0,
                    team2Wins: 0,
                    winnerId: null,
                    games: [
                        { id: 1, homeTeamId: top8Teams[2].id, awayTeamId: top8Teams[5].id, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 1", timestamp: Date.now() },
                        { id: 2, homeTeamId: top8Teams[5].id, awayTeamId: top8Teams[2].id, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 2", timestamp: Date.now() + 86400000 },
                        { id: 3, homeTeamId: top8Teams[2].id, awayTeamId: top8Teams[5].id, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 3", timestamp: Date.now() + 172800000 },
                        { id: 4, homeTeamId: top8Teams[5].id, awayTeamId: top8Teams[2].id, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 4", timestamp: Date.now() + 259200000 },
                        { id: 5, homeTeamId: top8Teams[2].id, awayTeamId: top8Teams[5].id, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 5", timestamp: Date.now() + 345600000 }
                    ]
                },
                { 
                    id: 4,
                    round: 1,
                    team1Id: top8Teams[3].id, 
                    team2Id: top8Teams[4].id,
                    team1Wins: 0,
                    team2Wins: 0,
                    winnerId: null,
                    games: [
                        { id: 1, homeTeamId: top8Teams[3].id, awayTeamId: top8Teams[4].id, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 1", timestamp: Date.now() },
                        { id: 2, homeTeamId: top8Teams[4].id, awayTeamId: top8Teams[3].id, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 2", timestamp: Date.now() + 86400000 },
                        { id: 3, homeTeamId: top8Teams[3].id, awayTeamId: top8Teams[4].id, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 3", timestamp: Date.now() + 172800000 },
                        { id: 4, homeTeamId: top8Teams[4].id, awayTeamId: top8Teams[3].id, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 4", timestamp: Date.now() + 259200000 },
                        { id: 5, homeTeamId: top8Teams[3].id, awayTeamId: top8Teams[4].id, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 5", timestamp: Date.now() + 345600000 }
                    ]
                }
            ];
            
            // Создаем серии для второго раунда (1/2 финала)
            const semifinalSeries = [
                { 
                    id: 5,
                    round: 2,
                    team1Id: null, // Победитель серии 1
                    team2Id: null, // Победитель серии 2
                    team1Wins: 0,
                    team2Wins: 0,
                    winnerId: null,
                    games: [
                        { id: 1, homeTeamId: null, awayTeamId: null, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 6", timestamp: Date.now() + 432000000 },
                        { id: 2, homeTeamId: null, awayTeamId: null, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 7", timestamp: Date.now() + 518400000 },
                        { id: 3, homeTeamId: null, awayTeamId: null, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 8", timestamp: Date.now() + 604800000 },
                        { id: 4, homeTeamId: null, awayTeamId: null, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 9", timestamp: Date.now() + 691200000 },
                        { id: 5, homeTeamId: null, awayTeamId: null, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 10", timestamp: Date.now() + 777600000 }
                    ]
                },
                { 
                    id: 6,
                    round: 2,
                    team1Id: null, // Победитель серии 3
                    team2Id: null, // Победитель серии 4
                    team1Wins: 0,
                    team2Wins: 0,
                    winnerId: null,
                    games: [
                        { id: 1, homeTeamId: null, awayTeamId: null, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 6", timestamp: Date.now() + 432000000 },
                        { id: 2, homeTeamId: null, awayTeamId: null, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 7", timestamp: Date.now() + 518400000 },
                        { id: 3, homeTeamId: null, awayTeamId: null, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 8", timestamp: Date.now() + 172800000 },
                        { id: 4, homeTeamId: null, awayTeamId: null, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 9", timestamp: Date.now() + 259200000 },
                        { id: 5, homeTeamId: null, awayTeamId: null, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 10", timestamp: Date.now() + 345600000 }
                    ]
                }
            ];
            
            // Создаем серию для финала
            const finalSeries = {
                id: 7,
                round: 3,
                team1Id: null, // Победитель серии 5
                team2Id: null, // Победитель серии 6
                team1Wins: 0,
                team2Wins: 0,
                winnerId: null,
                games: [
                    { id: 1, homeTeamId: null, awayTeamId: null, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 11", timestamp: Date.now() + 432000000 },
                    { id: 2, homeTeamId: null, awayTeamId: null, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 12", timestamp: Date.now() + 518400000 },
                    { id: 3, homeTeamId: null, awayTeamId: null, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 13", timestamp: Date.now() + 604800000 },
                    { id: 4, homeTeamId: null, awayTeamId: null, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 14", timestamp: Date.now() + 691200000 },
                    { id: 5, homeTeamId: null, awayTeamId: null, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 15", timestamp: Date.now() + 777600000 },
                    { id: 6, homeTeamId: null, awayTeamId: null, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 16", timestamp: Date.now() + 864000000 },
                    { id: 7, homeTeamId: null, awayTeamId: null, homeScore: 0, awayScore: 0, completed: false, overtime: false, date: "День 17", timestamp: Date.now() + 950400000 }
                ]
            };
            
            leagueData.playoff.series = [...quarterfinalSeries, ...semifinalSeries, finalSeries];
            leagueData.playoff.stage = "first_round";
            leagueData.playoff.champion = null;
            
            updateUI();
            updatePlayoffBracket();
            saveToLocalStorage();
            
            if (isFirebaseConnected) {
                saveDataToFirebase();
            }
            
            showNotification('Сетка плей-офф создана! 8 лучших команд определены.', 'success');
        }
        
        function updatePlayoffTeams() {
            if (leagueData.playoff.series.length === 0) {
                showNotification('Сначала создайте сетку плей-офф!', 'error');
                return;
            }
            
            // Получаем топ-8 команд из таблицы
            const sortedTeams = [...leagueData.teams].sort((a, b) => {
                if (b.points !== a.points) return b.points - a.points;
                if (b.wins !== a.wins) return b.wins - a.wins;
                return (b.goalsFor - b.goalsAgainst) - (a.goalsFor - a.goalsAgainst);
            });
            
            const top8Teams = sortedTeams.slice(0, 8);
            
            if (top8Teams.length < 8) {
                showNotification('Недостаточно команд для плей-офф! Нужно хотя бы 8 команд в таблице.', 'error');
                return;
            }
            
            // Обновляем только серии первого раунда, которые еще не начаты
            const quarterfinalSeries = leagueData.playoff.series.filter(s => s.round === 1);
            const pairs = [
                { team1: top8Teams[0], team2: top8Teams[7] },
                { team1: top8Teams[1], team2: top8Teams[6] },
                { team1: top8Teams[2], team2: top8Teams[5] },
                { team1: top8Teams[3], team2: top8Teams[4] }
            ];
            
            pairs.forEach((pair, index) => {
                if (index < quarterfinalSeries.length) {
                    const series = quarterfinalSeries[index];
                    
                    // Обновляем только если серия еще не начата
                    const hasStarted = series.games.some(g => g.completed);
                    if (!hasStarted) {
                        series.team1Id = pair.team1.id;
                        series.team2Id = pair.team2.id;
                        
                        // Обновляем команды в играх
                        series.games.forEach((game, gameIndex) => {
                            if (gameIndex % 2 === 0) {
                                game.homeTeamId = pair.team1.id;
                                game.awayTeamId = pair.team2.id;
                            } else {
                                game.homeTeamId = pair.team2.id;
                                game.awayTeamId = pair.team1.id;
                            }
                        });
                    }
                }
            });
            
            updateUI();
            updatePlayoffBracket();
            saveToLocalStorage();
            
            if (isFirebaseConnected) {
                saveDataToFirebase();
            }
            
            showNotification('Команды плей-офф обновлены из таблицы!', 'success');
        }
        
        function updatePlayoffBracket() {
            const playoffBracket = document.getElementById('playoffBracket');
            if (!playoffBracket) return;
            
            if (leagueData.playoff.series.length === 0) {
                playoffBracket.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-gray);">
                        <i class="fas fa-trophy" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i>
                        <p>Плей-офф еще не начат</p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">Администратор может сгенерировать сетку плей-офф через админ-панель</p>
                    </div>
                `;
                return;
            }
            
            playoffBracket.innerHTML = '';
            
            // Создаем контейнер для раундов
            const roundsContainer = document.createElement('div');
            roundsContainer.className = 'playoff-bracket';
            roundsContainer.style.display = 'flex';
            roundsContainer.style.justifyContent = 'space-between';
            
            // Группируем серии по раундам
            const round1Series = leagueData.playoff.series.filter(s => s.round === 1);
            const round2Series = leagueData.playoff.series.filter(s => s.round === 2);
            const round3Series = leagueData.playoff.series.filter(s => s.round === 3);
            
            // Раунд 1 (1/4 финала)
            const round1Div = document.createElement('div');
            round1Div.className = 'playoff-round';
            round1Div.style.flex = '1';
            
            round1Div.innerHTML = `
                <div class="playoff-round-title">1/4 ФИНАЛА</div>
            `;
            
            round1Series.forEach(series => {
                const team1 = leagueData.teams.find(t => t.id === series.team1Id);
                const team2 = leagueData.teams.find(t => t.id === series.team2Id);
                
                const seriesDiv = document.createElement('div');
                seriesDiv.className = 'playoff-series';
                seriesDiv.onclick = () => openPlayoffSeriesModal(series.id);
                
                let team1Name = team1 ? team1.name : 'TBD';
                let team2Name = team2 ? team2.name : 'TBD';
                let team1Logo = team1 && team1.logo ? team1.logo : null;
                let team2Logo = team2 && team2.logo ? team2.logo : null;
                
                // Определяем победителя
                let team1Class = '';
                let team2Class = '';
                let seriesScore = `${series.team1Wins} - ${series.team2Wins}`;
                
                if (series.winnerId) {
                    if (series.winnerId === series.team1Id) {
                        team1Class = 'winner';
                        team2Class = 'loser';
                    } else if (series.winnerId === series.team2Id) {
                        team1Class = 'loser';
                        team2Class = 'winner';
                    }
                }
                
                seriesDiv.innerHTML = `
                    <div class="playoff-series-header">
                        <div class="playoff-series-title">${team1Name} vs ${team2Name}</div>
                        <div class="playoff-series-score">${seriesScore}</div>
                    </div>
                    <div class="playoff-team ${team1Class}">
                        ${team1Logo ? `<img src="${team1Logo}" class="playoff-team-logo">` : ''}
                        <div class="playoff-team-name">${team1Name}</div>
                        <div class="playoff-team-wins">${series.team1Wins}</div>
                    </div>
                    <div class="playoff-team ${team2Class}">
                        ${team2Logo ? `<img src="${team2Logo}" class="playoff-team-logo">` : ''}
                        <div class="playoff-team-name">${team2Name}</div>
                        <div class="playoff-team-wins">${series.team2Wins}</div>
                    </div>
                `;
                
                round1Div.appendChild(seriesDiv);
            });
            
            roundsContainer.appendChild(round1Div);
            
            // Раунд 2 (1/2 финала)
            const round2Div = document.createElement('div');
            round2Div.className = 'playoff-round';
            round2Div.style.flex = '1';
            
            round2Div.innerHTML = `
                <div class="playoff-round-title">1/2 ФИНАЛА</div>
            `;
            
            round2Series.forEach(series => {
                const team1 = leagueData.teams.find(t => t.id === series.team1Id);
                const team2 = leagueData.teams.find(t => t.id === series.team2Id);
                
                const seriesDiv = document.createElement('div');
                seriesDiv.className = 'playoff-series';
                seriesDiv.onclick = () => openPlayoffSeriesModal(series.id);
                
                let team1Name = team1 ? team1.name : 'TBD';
                let team2Name = team2 ? team2.name : 'TBD';
                let team1Logo = team1 && team1.logo ? team1.logo : null;
                let team2Logo = team2 && team2.logo ? team2.logo : null;
                
                // Определяем победителя
                let team1Class = '';
                let team2Class = '';
                let seriesScore = `${series.team1Wins} - ${series.team2Wins}`;
                
                if (series.winnerId) {
                    if (series.winnerId === series.team1Id) {
                        team1Class = 'winner';
                        team2Class = 'loser';
                    } else if (series.winnerId === series.team2Id) {
                        team1Class = 'loser';
                        team2Class = 'winner';
                    }
                }
                
                seriesDiv.innerHTML = `
                    <div class="playoff-series-header">
                        <div class="playoff-series-title">${team1Name} vs ${team2Name}</div>
                        <div class="playoff-series-score">${seriesScore}</div>
                    </div>
                    <div class="playoff-team ${team1Class}">
                        ${team1Logo ? `<img src="${team1Logo}" class="playoff-team-logo">` : ''}
                        <div class="playoff-team-name">${team1Name}</div>
                        <div class="playoff-team-wins">${series.team1Wins}</div>
                    </div>
                    <div class="playoff-team ${team2Class}">
                        ${team2Logo ? `<img src="${team2Logo}" class="playoff-team-logo">` : ''}
                        <div class="playoff-team-name">${team2Name}</div>
                        <div class="playoff-team-wins">${series.team2Wins}</div>
                    </div>
                `;
                
                round2Div.appendChild(seriesDiv);
            });
            
            roundsContainer.appendChild(round2Div);
            
            // Раунд 3 (Финал)
            if (round3Series.length > 0) {
                const round3Div = document.createElement('div');
                round3Div.className = 'playoff-round';
                round3Div.style.flex = '1';
                
                round3Div.innerHTML = `
                    <div class="playoff-round-title">ФИНАЛ</div>
                `;
                
                round3Series.forEach(series => {
                    const team1 = leagueData.teams.find(t => t.id === series.team1Id);
                    const team2 = leagueData.teams.find(t => t.id === series.team2Id);
                    
                    const seriesDiv = document.createElement('div');
                    seriesDiv.className = 'playoff-series';
                    seriesDiv.onclick = () => openPlayoffSeriesModal(series.id);
                    
                    let team1Name = team1 ? team1.name : 'TBD';
                    let team2Name = team2 ? team2.name : 'TBD';
                    let team1Logo = team1 && team1.logo ? team1.logo : null;
                    let team2Logo = team2 && team2.logo ? team2.logo : null;
                    
                    // Определяем победителя
                    let team1Class = '';
                    let team2Class = '';
                    let seriesScore = `${series.team1Wins} - ${series.team2Wins}`;
                    
                    if (series.winnerId) {
                        if (series.winnerId === series.team1Id) {
                            team1Class = 'winner';
                            team2Class = 'loser';
                        } else if (series.winnerId === series.team2Id) {
                            team1Class = 'loser';
                            team2Class = 'winner';
                        }
                    }
                    
                    seriesDiv.innerHTML = `
                        <div class="playoff-series-header">
                            <div class="playoff-series-title">${team1Name} vs ${team2Name}</div>
                            <div class="playoff-series-score">${seriesScore}</div>
                        </div>
                        <div class="playoff-team ${team1Class}">
                            ${team1Logo ? `<img src="${team1Logo}" class="playoff-team-logo">` : ''}
                            <div class="playoff-team-name">${team1Name}</div>
                            <div class="playoff-team-wins">${series.team1Wins}</div>
                        </div>
                        <div class="playoff-team ${team2Class}">
                            ${team2Logo ? `<img src="${team2Logo}" class="playoff-team-logo">` : ''}
                            <div class="playoff-team-name">${team2Name}</div>
                            <div class="playoff-team-wins">${series.team2Wins}</div>
                        </div>
                    `;
                    
                    round3Div.appendChild(seriesDiv);
                });
                
                roundsContainer.appendChild(round3Div);
            }
            
            playoffBracket.appendChild(roundsContainer);
        }
        
        function openPlayoffSeriesModal(seriesId) {
            const series = leagueData.playoff.series.find(s => s.id === seriesId);
            if (!series) return;
            
            currentPlayoffSeriesId = seriesId;
            
            const team1 = leagueData.teams.find(t => t.id === series.team1Id);
            const team2 = leagueData.teams.find(t => t.id === series.team2Id);
            
            // Обновляем заголовок
            let roundTitle = '';
            switch(series.round) {
                case 1: roundTitle = '1/4 ФИНАЛА'; break;
                case 2: roundTitle = '1/2 ФИНАЛА'; break;
                case 3: roundTitle = 'ФИНАЛ'; break;
            }
            
            document.getElementById('playoffSeriesTitle').textContent = `${roundTitle}: ${team1 ? team1.name : 'TBD'} vs ${team2 ? team2.name : 'TBD'}`;
            document.getElementById('playoffSeriesScore').textContent = `${series.team1Wins} - ${series.team2Wins}`;
            
            // Определяем статус серии
            let statusText = '';
            let statusClass = '';
            
            const gamesPlayed = series.games.filter(g => g.completed).length;
            const totalGames = series.games.length;
            const winsNeeded = Math.ceil(totalGames / 2);
            
            document.getElementById('playoffSeriesProgress').textContent = `Сыграно: ${gamesPlayed} из ${totalGames} (нужно ${winsNeeded} побед)`;
            
            if (series.winnerId) {
                const winner = leagueData.teams.find(t => t.id === series.winnerId);
                statusText = `Завершена. Победитель: ${winner ? winner.name : 'Неизвестно'}`;
                statusClass = 'status-completed';
            } else if (gamesPlayed > 0) {
                statusText = 'В процессе';
                statusClass = 'status-in-progress';
            } else {
                statusText = 'Не начата';
                statusClass = 'status-not-started';
            }
            
            const statusElement = document.getElementById('playoffSeriesStatus');
            statusElement.textContent = statusText;
            statusElement.className = `playoff-series-status ${statusClass}`;
            
            // Очищаем список матчей
            const matchesContainer = document.getElementById('playoffSeriesMatches');
            matchesContainer.innerHTML = '';
            
            // Добавляем матчи
            series.games.forEach(game => {
                const homeTeam = leagueData.teams.find(t => t.id === game.homeTeamId);
                const awayTeam = leagueData.teams.find(t => t.id === game.awayTeamId);
                
                const matchCard = document.createElement('div');
                matchCard.className = 'playoff-match-card';
                
                matchCard.innerHTML = `
                    <div class="playoff-match-header">
                        <div class="playoff-match-number">Матч ${game.id}</div>
                        <div style="color: var(--text-gray); font-size: 0.9rem;">${game.date}</div>
                    </div>
                    <div class="playoff-match-body">
                        <div class="playoff-match-team playoff-match-team-home">
                            <div class="playoff-team-name">${homeTeam ? homeTeam.name : 'TBD'}</div>
                            ${homeTeam && homeTeam.logo ? `<img src="${homeTeam.logo}" class="playoff-match-team-logo">` : ''}
                            <input type="number" class="playoff-match-score-input" id="playoff_homeScore_${seriesId}_${game.id}" value="${game.homeScore}" ${game.completed || !isAdminAuthenticated ? '' : ''}>
                        </div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--accent-red); margin: 0 20px;">${game.completed ? `${game.homeScore}:${game.awayScore}` : 'vs'}</div>
                        <div class="playoff-match-team playoff-match-team-away">
                            <input type="number" class="playoff-match-score-input" id="playoff_awayScore_${seriesId}_${game.id}" value="${game.awayScore}" ${game.completed || !isAdminAuthenticated ? '' : ''}>
                            ${awayTeam && awayTeam.logo ? `<img src="${awayTeam.logo}" class="playoff-match-team-logo">` : ''}
                            <div class="playoff-team-name">${awayTeam ? awayTeam.name : 'TBD'}</div>
                        </div>
                    </div>
                    <div style="margin-top: 10px; display: flex; gap: 10px; justify-content: center;">
                        <label style="color: var(--text-gray); display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" id="playoff_overtime_${seriesId}_${game.id}" ${game.overtime ? 'checked' : ''} ${!isAdminAuthenticated ? 'disabled' : ''}> Овертайм
                        </label>
                        <label style="color: var(--text-gray); display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" id="playoff_completed_${seriesId}_${game.id}" ${game.completed ? 'checked' : ''} ${!isAdminAuthenticated ? 'disabled' : ''} onchange="togglePlayoffGameEdit(${seriesId}, ${game.id})"> Завершен
                        </label>
                    </div>
                    ${isAdminAuthenticated ? `
                    <div style="margin-top: 10px; display: flex; gap: 5px; justify-content: center;">
                        <button class="match-action-btn simulate" onclick="simulatePlayoffGame(${seriesId}, ${game.id})">
                            <i class="fas fa-play"></i> Симулировать
                        </button>
                        <button class="match-action-btn reset" onclick="resetPlayoffGame(${seriesId}, ${game.id})">
                            <i class="fas fa-undo"></i> Сбросить
                        </button>
                    </div>
                    ` : ''}
                `;
                
                matchesContainer.appendChild(matchCard);
            });
            
            // Показываем модальное окно
            document.getElementById('playoffSeriesModal').style.display = 'flex';
        }
        
        function closePlayoffSeriesModal() {
            document.getElementById('playoffSeriesModal').style.display = 'none';
            currentPlayoffSeriesId = null;
        }
        
        function togglePlayoffGameEdit(seriesId, gameId) {
            if (!isAdminAuthenticated) return;
            
            const series = leagueData.playoff.series.find(s => s.id === seriesId);
            if (!series) return;
            
            const game = series.games.find(g => g.id === gameId);
            if (!game) return;
            
            const completedCheckbox = document.getElementById(`playoff_completed_${seriesId}_${gameId}`);
            game.completed = completedCheckbox.checked;
            
            const homeScoreInput = document.getElementById(`playoff_homeScore_${seriesId}_${gameId}`);
            const awayScoreInput = document.getElementById(`playoff_awayScore_${seriesId}_${gameId}`);
            
            if (game.completed) {
                homeScoreInput.disabled = false;
                awayScoreInput.disabled = false;
            } else {
                homeScoreInput.disabled = true;
                awayScoreInput.disabled = true;
            }
        }
        
        function simulatePlayoffGame(seriesId, gameId) {
            if (!isAdminAuthenticated) return;
            
            const series = leagueData.playoff.series.find(s => s.id === seriesId);
            if (!series) return;
            
            const game = series.games.find(g => g.id === gameId);
            if (!game) return;
            
            // Генерируем случайный счет
            let homeScore = Math.floor(Math.random() * 4);
            let awayScore = Math.floor(Math.random() * 4);
            
            // 25% шанс на овертайм в плей-офф
            const isOvertime = Math.random() < 0.25;
            
            if (isOvertime && homeScore === awayScore) {
                // В овертайме добавляем один гол
                if (Math.random() > 0.5) {
                    homeScore += 1;
                } else {
                    awayScore += 1;
                }
            } else if (homeScore === awayScore) {
                // Если ничья в основное время, делаем разницу в 1 гол
                if (Math.random() > 0.5) {
                    homeScore += 1;
                } else {
                    awayScore += 1;
                }
            }
            
            game.homeScore = homeScore;
            game.awayScore = awayScore;
            game.overtime = isOvertime && homeScore !== awayScore;
            game.completed = true;
            
            // Обновляем поля ввода
            document.getElementById(`playoff_homeScore_${seriesId}_${gameId}`).value = homeScore;
            document.getElementById(`playoff_awayScore_${seriesId}_${gameId}`).value = awayScore;
            document.getElementById(`playoff_overtime_${seriesId}_${gameId}`).checked = game.overtime;
            document.getElementById(`playoff_completed_${seriesId}_${gameId}`).checked = true;
            
            // Обновляем статистику серии
            updatePlayoffSeriesStats(seriesId);
            
            showNotification(`Матч плей-офф симулирован: ${homeScore}:${awayScore}${game.overtime ? ' (ОТ)' : ''}`, 'success');
        }
        
        function resetPlayoffGame(seriesId, gameId) {
            if (!isAdminAuthenticated) return;
            
            const series = leagueData.playoff.series.find(s => s.id === seriesId);
            if (!series) return;
            
            const game = series.games.find(g => g.id === gameId);
            if (!game) return;
            
            // Сбрасываем счет
            game.homeScore = 0;
            game.awayScore = 0;
            game.overtime = false;
            game.completed = false;
            
            // Обновляем поля ввода
            document.getElementById(`playoff_homeScore_${seriesId}_${gameId}`).value = 0;
            document.getElementById(`playoff_awayScore_${seriesId}_${gameId}`).value = 0;
            document.getElementById(`playoff_overtime_${seriesId}_${gameId}`).checked = false;
            document.getElementById(`playoff_completed_${seriesId}_${gameId}`).checked = false;
            document.getElementById(`playoff_homeScore_${seriesId}_${gameId}`).disabled = true;
            document.getElementById(`playoff_awayScore_${seriesId}_${gameId}`).disabled = true;
            
            // Обновляем статистику серии
            updatePlayoffSeriesStats(seriesId);
            
            showNotification('Матч плей-офф сброшен!', 'success');
        }
        
        function simulateAllPlayoffSeriesGames() {
            if (!isAdminAuthenticated || !currentPlayoffSeriesId) return;
            
            const series = leagueData.playoff.series.find(s => s.id === currentPlayoffSeriesId);
            if (!series) return;
            
            let simulatedCount = 0;
            
            series.games.forEach(game => {
                if (!game.completed) {
                    simulatePlayoffGame(series.id, game.id);
                    simulatedCount++;
                }
            });
            
            if (simulatedCount > 0) {
                showNotification(`Симулировано ${simulatedCount} матчей в серии!`, 'success');
            } else {
                showNotification('Все матчи в серии уже сыграны!', 'info');
            }
        }
        
        function resetPlayoffSeries() {
            if (!isAdminAuthenticated || !currentPlayoffSeriesId) return;
            
            if (!confirm('Вы уверены, что хотите сбросить всю серию? Все результаты матчей будут удалены.')) {
                return;
            }
            
            const series = leagueData.playoff.series.find(s => s.id === currentPlayoffSeriesId);
            if (!series) return;
            
            // Сбрасываем все матчи
            series.games.forEach(game => {
                game.homeScore = 0;
                game.awayScore = 0;
                game.overtime = false;
                game.completed = false;
            });
            
            // Сбрасываем статистику серии
            series.team1Wins = 0;
            series.team2Wins = 0;
            series.winnerId = null;
            
            // Обновляем UI
            openPlayoffSeriesModal(currentPlayoffSeriesId);
            updatePlayoffBracket();
            saveToLocalStorage();
            
            if (isFirebaseConnected) {
                saveDataToFirebase();
            }
            
            showNotification('Серия плей-офф сброшена!', 'success');
        }
        
        function savePlayoffSeries() {
            if (!isAdminAuthenticated || !currentPlayoffSeriesId) return;
            
            const series = leagueData.playoff.series.find(s => s.id === currentPlayoffSeriesId);
            if (!series) return;
            
            // Обновляем результаты матчей
            series.games.forEach(game => {
                const homeScore = parseInt(document.getElementById(`playoff_homeScore_${series.id}_${game.id}`).value) || 0;
                const awayScore = parseInt(document.getElementById(`playoff_awayScore_${series.id}_${game.id}`).value) || 0;
                const overtime = document.getElementById(`playoff_overtime_${series.id}_${game.id}`).checked;
                const completed = document.getElementById(`playoff_completed_${series.id}_${game.id}`).checked;
                
                game.homeScore = homeScore;
                game.awayScore = awayScore;
                game.overtime = overtime;
                game.completed = completed;
            });
            
            // Обновляем статистику серии
            updatePlayoffSeriesStats(series.id);
            
            // Сохраняем изменения
            saveToLocalStorage();
            
            if (isFirebaseConnected) {
                saveDataToFirebase();
            }
            
            showNotification('Изменения в серии сохранены!', 'success');
        }
        
        function updatePlayoffSeriesStats(seriesId) {
            const series = leagueData.playoff.series.find(s => s.id === seriesId);
            if (!series) return;
            
            // Сбрасываем счет
            series.team1Wins = 0;
            series.team2Wins = 0;
            
            // Подсчитываем победы
            series.games.forEach(game => {
                if (game.completed) {
                    if (game.homeScore > game.awayScore) {
                        if (game.homeTeamId === series.team1Id) {
                            series.team1Wins++;
                        } else if (game.homeTeamId === series.team2Id) {
                            series.team2Wins++;
                        }
                    } else if (game.awayScore > game.homeScore) {
                        if (game.awayTeamId === series.team1Id) {
                            series.team1Wins++;
                        } else if (game.awayTeamId === series.team2Id) {
                            series.team2Wins++;
                        }
                    }
                }
            });
            
            saveToLocalStorage();
            
            if (isFirebaseConnected) {
                saveDataToFirebase();
            }
            
            // Определяем победителя
            const winsNeeded = Math.ceil(series.games.length / 2);
            if (series.team1Wins >= winsNeeded) {
                series.winnerId = series.team1Id;
                advanceToNextRound(series);
            } else if (series.team2Wins >= winsNeeded) {
                series.winnerId = series.team2Id;
                advanceToNextRound(series);
            } else {
                series.winnerId = null;
            }
            
            // Обновляем UI
            if (currentPlayoffSeriesId === seriesId) {
                openPlayoffSeriesModal(seriesId);
            }
            updatePlayoffBracket();
            updatePlayoffStats();
        }
        
        function advanceToNextRound(series) {
            if (!series.winnerId) return;
            
            const nextRound = series.round + 1;
            const nextRoundSeries = leagueData.playoff.series.filter(s => s.round === nextRound);
            
            // Находим первую доступную серию в следующем раунде
            const availableSeries = nextRoundSeries.filter(s => !s.team1Id || !s.team2Id);
            
            if (availableSeries.length > 0) {
                const nextSeries = availableSeries[0];
                
                // Определяем позицию для команды в следующем раунде
                if (!nextSeries.team1Id) {
                    nextSeries.team1Id = series.winnerId;
                    
                    // Обновляем команды в играх
                    nextSeries.games.forEach((game, index) => {
                        // Команда играет дома в нечетных играх
                        if (index % 2 === 0) {
                            game.homeTeamId = series.winnerId;
                        } else {
                            game.awayTeamId = series.winnerId;
                        }
                    });
                } else if (!nextSeries.team2Id) {
                    nextSeries.team2Id = series.winnerId;
                    
                    // Обновляем команды в играх
                    nextSeries.games.forEach((game, index) => {
                        // Команда играет в гостях в нечетных играх
                        if (index % 2 === 0) {
                            game.awayTeamId = series.winnerId;
                        } else {
                            game.homeTeamId = series.winnerId;
                        }
                    });
                }
                
                // Обновляем стадию плей-офф
                if (nextRound === 2 && leagueData.playoff.stage === "first_round") {
                    leagueData.playoff.stage = "second_round";
                } else if (nextRound === 3 && leagueData.playoff.stage === "second_round") {
                    leagueData.playoff.stage = "final";
                }
                
                // Если это финал и определился победитель
                if (nextRound === 3 && nextSeries.winnerId) {
                    leagueData.playoff.stage = "finished";
                    leagueData.playoff.champion = nextSeries.winnerId;
                }
            }
        }
        
        function updatePlayoffStats() {
            const stageElement = document.getElementById('playoffStage');
            const matchesPlayedElement = document.getElementById('playoffMatchesPlayed');
            const totalMatchesElement = document.getElementById('playoffTotalMatches');
            const championElement = document.getElementById('playoffChampion');
            
            if (!stageElement) return;
            
            // Подсчитываем статистику
            let totalMatches = 0;
            let matchesPlayed = 0;
            
            leagueData.playoff.series.forEach(series => {
                totalMatches += series.games.length;
                matchesPlayed += series.games.filter(g => g.completed).length;
            });
            
            // Обновляем стадию
            let stageText = '';
            switch(leagueData.playoff.stage) {
                case "not_started": stageText = "Не начат"; break;
                case "first_round": stageText = "1/4 финала"; break;
                case "second_round": stageText = "1/2 финала"; break;
                case "final": stageText = "Финал"; break;
                case "finished": stageText = "Завершен"; break;
                default: stageText = leagueData.playoff.stage;
            }
            
            stageElement.textContent = stageText;
            matchesPlayedElement.textContent = matchesPlayed;
            totalMatchesElement.textContent = totalMatches;
            
            // Обновляем чемпиона
            if (leagueData.playoff.champion) {
                const championTeam = leagueData.teams.find(t => t.id === leagueData.playoff.champion);
                championElement.textContent = championTeam ? championTeam.name : "Неизвестно";
            } else {
                championElement.textContent = "Не определен";
            }
        }
        
        function updatePlayoffAdminUI() {
            const adminPlayoffSeriesList = document.getElementById('adminPlayoffSeriesList');
            if (!adminPlayoffSeriesList) return;
            
            adminPlayoffSeriesList.innerHTML = '';
            
            if (leagueData.playoff.series.length === 0) {
                adminPlayoffSeriesList.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--text-gray);">
                        <p>Сетка плей-офф не создана</p>
                        <button class="btn btn-small" onclick="generatePlayoffBracket()" style="margin-top: 10px;">
                            <i class="fas fa-sitemap"></i> Создать сетку
                        </button>
                    </div>
                `;
                return;
            }
            
            // Группируем серии по раундам
            const rounds = {
                1: leagueData.playoff.series.filter(s => s.round === 1),
                2: leagueData.playoff.series.filter(s => s.round === 2),
                3: leagueData.playoff.series.filter(s => s.round === 3)
            };
            
            for (let roundNum = 1; roundNum <= 3; roundNum++) {
                const seriesInRound = rounds[roundNum] || [];
                if (seriesInRound.length === 0) continue;
                
                let roundTitle = '';
                switch(roundNum) {
                    case 1: roundTitle = '1/4 ФИНАЛА'; break;
                    case 2: roundTitle = '1/2 ФИНАЛА'; break;
                    case 3: roundTitle = 'ФИНАЛ'; break;
                }
                
                const roundHeader = document.createElement('div');
                roundHeader.style.marginTop = '20px';
                roundHeader.style.marginBottom = '10px';
                roundHeader.style.paddingBottom = '5px';
                roundHeader.style.borderBottom = '2px solid var(--accent-red)';
                roundHeader.innerHTML = `<h4>${roundTitle}</h4>`;
                adminPlayoffSeriesList.appendChild(roundHeader);
                
                seriesInRound.forEach(series => {
                    const team1 = leagueData.teams.find(t => t.id === series.team1Id);
                    const team2 = leagueData.teams.find(t => t.id === series.team2Id);
                    
                    const seriesItem = document.createElement('div');
                    seriesItem.className = 'team-list-item';
                    seriesItem.style.cursor = 'pointer';
                    seriesItem.onclick = () => openPlayoffSeriesModal(series.id);
                    
                    const team1Name = team1 ? team1.name : 'TBD';
                    const team2Name = team2 ? team2.name : 'TBD';
                    const gamesPlayed = series.games.filter(g => g.completed).length;
                    const totalGames = series.games.length;
                    
                    seriesItem.innerHTML = `
                        <div class="team-list-info">
                            <div>
                                <div class="team-list-name">${team1Name} vs ${team2Name}</div>
                                <div class="team-list-stats">
                                    Счет: ${series.team1Wins} - ${series.team2Wins} | Матчи: ${gamesPlayed}/${totalGames}
                                    ${series.winnerId ? ' | Завершена' : ''}
                                </div>
                            </div>
                        </div>
                        <div class="team-actions">
                            <div class="action-btn edit" onclick="openPlayoffSeriesModal(${series.id})" title="Управление серией">
                                <i class="fas fa-edit"></i>
                            </div>
                        </div>
                    `;
                    
                    adminPlayoffSeriesList.appendChild(seriesItem);
                });
            }
            
            updatePlayoffStats();
        }
        
        // ==================== ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ====================
        
        function clearTeamLogoPreview() {
            uploadedTeamLogoDataURL = null;
            document.getElementById('teamLogoPreview').src = '';
            document.getElementById('teamLogoPreview').style.display = 'none';
            document.getElementById('teamLogoUpload').value = '';
        }
        
        function clearNewsImagePreview() {
            uploadedNewsImageDataURL = null;
            document.getElementById('newsImagePreview').src = '';
            document.getElementById('newsImagePreview').style.display = 'none';
            document.getElementById('newsImageUpload').value = '';
        }
        
        function clearLeagueLogoPreview() {
            uploadedLeagueLogoDataURL = null;
            document.getElementById('leagueLogoPreview').src = '';
            document.getElementById('leagueLogoPreview').style.display = 'none';
            document.getElementById('leagueLogoUpload').value = '';
        }
        
        function switchPage(pageId) {
            const pages = document.querySelectorAll('.page');
            const navButtons = document.querySelectorAll('.nav-btn');
            
            pages.forEach(page => page.classList.remove('active'));
            navButtons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(pageId).classList.add('active');
            document.querySelector(`.nav-btn[data-page="${pageId.replace('Page', '')}"]`).classList.add('active');
        }
        
        function showImageModal(imageSrc) {
            if (!imageSrc) {
                showNotification('Изображение не найдено', 'error');
                return;
            }
            
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            
            modalImage.src = imageSrc;
            modal.style.display = 'flex';
        }
        
        function closeModal() {
            document.getElementById('imageModal').style.display = 'none';
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            notification.className = 'notification';
            
            if (type === 'error') {
                notification.classList.add('error');
                notification.innerHTML = `<i class="fas fa-exclamation-circle"></i><span id="notificationText">${message}</span>`;
            } else if (type === 'success') {
                notification.classList.add('success');
                notification.innerHTML = `<i class="fas fa-check-circle"></i><span id="notificationText">${message}</span>`;
            } else {
                notification.classList.add('info');
                notification.innerHTML = `<i class="fas fa-info-circle"></i><span id="notificationText">${message}</span>`;
            }
            
            notification.style.display = 'flex';
            setTimeout(() => notification.style.display = 'none', 5000);
        }
        
        function showLoader(loaderId, show) {
            const loader = document.getElementById(loaderId);
            if (loader) loader.style.display = show ? 'block' : 'none';
        }
        
        function saveToLocalStorage() {
            try {
                localStorage.setItem('dhl_league_data', JSON.stringify(leagueData));
            } catch (error) {
                console.error('Ошибка сохранения в LocalStorage:', error);
            }
        }
        
        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem('dhl_league_data');
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    leagueData = { ...leagueData, ...parsedData };
                }
            } catch (error) {
                console.error('Ошибка загрузки из LocalStorage:', error);
            }
        }
        
        function fillAdminFields() {
            if (document.getElementById('leagueName')) {
                document.getElementById('leagueName').value = leagueData.name;
                document.getElementById('leagueDescription').value = leagueData.description;
                document.getElementById('homepageText').value = leagueData.homepageText;
                
                if (leagueData.settings.firebaseConfig) {
                    document.getElementById('firebaseConfig').value = leagueData.settings.firebaseConfig;
                }
                
                if (leagueData.settings.imgbbApiKey) {
                    document.getElementById('imgbbApiKey').value = leagueData.settings.imgbbApiKey;
                }
            }
        }
        
        function resetTeamStats(teamId) {
            const team = leagueData.teams.find(t => t.id === teamId);
            if (!team) return;
            
            team.games = 0;
            team.wins = 0;
            team.otWins = 0;
            team.otLosses = 0;
            team.losses = 0;
            team.goalsFor = 0;
            team.goalsAgainst = 0;
            team.points = 0;
            team.last5 = [];
            
            // Пересчитываем статистику всех команд
            recalculateAllTeamStats();
            
            // Обновляем весь интерфейс
            forceRefreshAll();
            
            showNotification(`Статистика команды "${team.name}" сброшена!`, 'success');
        }
        
        function resetAllTeamsStats() {
            if (!confirm('Вы уверены, что хотите сбросить статистику всех команд?')) {
                return;
            }
            
            leagueData.teams.forEach(team => {
                team.games = 0;
                team.wins = 0;
                team.otWins = 0;
                team.otLosses = 0;
                team.losses = 0;
                team.goalsFor = 0;
                team.goalsAgainst = 0;
                team.points = 0;
                team.last5 = [];
            });
            
            // Также сбрасываем все матчи
            leagueData.matches.forEach(match => {
                match.homeScore = 0;
                match.awayScore = 0;
                match.overtime = false;
                match.completed = false;
            });
            
            // Обновляем весь интерфейс
            forceRefreshAll();
            
            showNotification('Статистика всех команд сброшена!', 'success');
        }
        
        function populateTeamSelects() {
            const homeSelect = document.getElementById('matchHomeTeam');
            const awaySelect = document.getElementById('matchAwayTeam');
            
            if (!homeSelect || !awaySelect) return;
            
            homeSelect.innerHTML = '<option value="">Выберите команду</option>';
            awaySelect.innerHTML = '<option value="">Выберите команду</option>';
            
            leagueData.teams.forEach(team => {
                const option1 = document.createElement('option');
                option1.value = team.id;
                option1.textContent = team.name;
                homeSelect.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = team.id;
                option2.textContent = team.name;
                awaySelect.appendChild(option2);
            });
        }
        
        function addMatchManually() {
            const homeSelect = document.getElementById('matchHomeTeam');
            const awaySelect = document.getElementById('matchAwayTeam');
            const homeScore = parseInt(document.getElementById('matchHomeScore').value) || 0;
            const awayScore = parseInt(document.getElementById('matchAwayScore').value) || 0;
            const overtime = document.getElementById('matchOvertime').checked;
            
            if (!homeSelect.value || !awaySelect.value) {
                showNotification('Выберите обе команды!', 'error');
                return;
            }
            
            if (homeSelect.value === awaySelect.value) {
                showNotification('Команда не может играть сама с собой!', 'error');
                return;
            }
            
            if (homeScore === awayScore && !overtime) {
                showNotification('При равном счете должен быть отмечен овертайм!', 'error');
                return;
            }
            
            const newMatch = {
                id: leagueData.matches.length > 0 ? Math.max(...leagueData.matches.map(m => m.id)) + 1 : 1,
                homeTeamId: parseInt(homeSelect.value),
                awayTeamId: parseInt(awaySelect.value),
                homeScore: homeScore,
                awayScore: awayScore,
                completed: true,
                overtime: overtime,
                date: new Date().toLocaleDateString('ru-RU'),
                timestamp: new Date().getTime(),
                round: Math.floor(Math.random() * 10) + 1
            };
            
            leagueData.matches.push(newMatch);
            
            // Обновляем статистику команд
            updateTeamStats(newMatch);
            
            // Обновляем весь интерфейс
            forceRefreshAll();
            
            // Очищаем форму
            homeSelect.value = '';
            awaySelect.value = '';
            document.getElementById('matchHomeScore').value = 0;
            document.getElementById('matchAwayScore').value = 0;
            document.getElementById('matchOvertime').checked = false;
            
            showNotification('Матч добавлен!', 'success');
        }
        
        function updateMatchesUI() {
            const matchesContainer = document.getElementById('matchesContainer');
            if (!matchesContainer) return;
            
            matchesContainer.innerHTML = '';
            
            // Сортируем матчи по дате
            const sortedMatches = [...leagueData.matches].sort((a, b) => {
                if (a.timestamp && b.timestamp) {
                    return a.timestamp - b.timestamp;
                }
                return a.id - b.id;
            });
            
            sortedMatches.forEach(match => {
                const homeTeam = leagueData.teams.find(t => t.id === match.homeTeamId);
                const awayTeam = leagueData.teams.find(t => t.id === match.awayTeamId);
                
                if (!homeTeam || !awayTeam) return;
                
                const matchCard = document.createElement('div');
                matchCard.className = 'match-card';
                matchCard.style.position = 'relative';
                
                let resultClass = '';
                if (match.completed) {
                    if (match.homeScore > match.awayScore) {
                        resultClass = 'win';
                    } else if (match.homeScore < match.awayScore) {
                        resultClass = 'loss';
                    } else {
                        resultClass = 'ot';
                    }
                }
                
                // Добавляем кнопку редактирования для админа
                const editButton = isAdminAuthenticated ? 
                    `<button class="match-edit-btn" onclick="editMatchScoreInCalendar(${match.id})" title="Редактировать счет">
                        <i class="fas fa-edit"></i>
                    </button>` : '';
                
                matchCard.innerHTML = `
                    ${editButton}
                    <div class="match-header">
                        <div class="match-date">${match.date}</div>
                        <div class="match-round">Тур ${match.round || 1}</div>
                    </div>
                    <div class="match-body">
                        <div class="match-team match-team-home">
                            <div class="match-team-name">${homeTeam.name}</div>
                            ${homeTeam.logo ? `<img src="${homeTeam.logo}" class="match-team-logo">` : '<div class="match-team-logo">' + homeTeam.name.charAt(0) + '</div>'}
                        </div>
                        <div class="match-score">${match.completed ? `${match.homeScore}:${match.awayScore}` : 'vs'}</div>
                        <div class="match-team match-team-away">
                            ${awayTeam.logo ? `<img src="${awayTeam.logo}" class="match-team-logo">` : '<div class="match-team-logo">' + awayTeam.name.charAt(0) + '</div>'}
                            <div class="match-team-name">${awayTeam.name}</div>
                        </div>
                    </div>
                    ${match.completed ? `<div class="match-result ${resultClass}">${match.overtime ? 'Овертайм' : 'Основное время'}</div>` : ''}
                `;
                
                matchesContainer.appendChild(matchCard);
            });
        }
        
        function filterMatches(filterType) {
            // Реализация фильтрации матчей
            updateMatchesUI();
        }
        
        console.log('ДХЛ с исправленной системой матчей и PWA успешно загружена!');
    </script>
</body>
</html>
